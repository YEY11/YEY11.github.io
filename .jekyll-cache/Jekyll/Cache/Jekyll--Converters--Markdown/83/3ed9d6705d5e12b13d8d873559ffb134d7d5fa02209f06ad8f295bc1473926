I"ча<h2 id="1-йЎ№иѓЊж™Ї">1. йЎ№вЅ¬иѓЊж™Ї</h2>

<p>йљЏзќЂз”µе•†вѕЏдёљиї‘вјЏе№ґзљ„иї…зЊ›еЏ‘е±•пјЊз”µвј¦е•†еЉЎд»Ћж—©дє›е№ґзљ„зІ—ж”ѕејЏз»ЏиђҐпјЊйЂђж­ҐиЅ¬еЊ–дёєзІѕз»†еЊ–иїђиђҐгЂ‚йљЏзќЂе№іеЏ°ж•°жЌ®й‡Џзљ„дёЌж–­з§ЇзґЇпјЊйЂљиї‡ж•°жЌ®е€†жћђжЊ–жЋж¶€иґ№иЂ…зљ„жЅњењЁйњЂж±‚пјЊж¶€иґ№еЃЏеҐЅж€ђдёєе№іеЏ°иїђиђҐиї‡зЁ‹дё­зљ„й‡Ќи¦ЃзЋЇиЉ‚гЂ‚жњ¬йЎ№вЅ¬еџєдєЋжџђз”µе•†е№іеЏ°вЅ¤ж€·вѕЏдёєж•°жЌ®пјЊењЁ MySQL е…ізі»ећ‹ж•°жЌ®еє“пјЊжЋўзґўвЅ¤ж€·вѕЏдёєи§„еѕ‹пјЊеЇ»ж‰ѕвѕјд»·еЂјвЅ¤ж€·пј›е€†жћђе•†е“Ѓз‰№еѕЃпјЊеЇ»ж‰ѕвѕјиґЎзЊ®е•†е“Ѓпј›е€†жћђдє§е“ЃеЉџиѓЅпјЊдјеЊ–дє§е“Ѓи·Їеѕ„гЂ‚</p>

<h2 id="2-е€†жћђжµЃзЁ‹">2. е€†жћђжµЃзЁ‹</h2>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-06-30-iShot2021-06-30%2023.27.07.png" width="100%" /></p>

<p>й¦–е…€пјЊж€‘д»¬зњ‹дёЂдё‹жњЂдё‹йќўзљ„ <strong>еџєзЎЂж•°жЌ®</strong> жЁЎеќ—гЂ‚иї™дє›еџєзЎЂж•°жЌ®дёЂи€¬жЇз”±дёљеЉЎзі»з»џе·ҐзЁ‹её€жЏђдѕ›пјЊд»–д»¬еЏЇиѓЅдјљй‡‡й›†дёЂдє›ж—Ґеї—ж–‡д»¶пјЊе№¶еЇ№иї™дє›ж—Ґеї—ж–‡д»¶иї›иЎЊе€†жћђпјЊз„¶еђЋж”ѕе…Ґж•°жЌ®еє“дё­гЂ‚ж­¤жЎ€дѕ‹дё­зљ„еџєзЎЂж•°жЌ®еЏЇиѓЅдјљж¶‰еЏЉе€°з”Ёж€·иЎЊдёєж•°жЌ®пјЊдѕ‹е¦‚пјљеЅ“з”Ёж€·ж”¶и—Џжџђд»¶е•†е“Ѓж—¶пјЊдјљз”џж€ђдёЂжќЎи®°еЅ•пј›еЅ“з”Ёж€·е°†е•†е“ЃеЉ е…Ґиґ­з‰©иЅ¦ж—¶пјЊдјљз”џж€ђдёЂжќЎи®°еЅ•пј›еЅ“з”Ёж€·иї›иЎЊж”Їд»иґ­д№°ж—¶пјЊдјљз”џж€ђдёЂжќЎи®°еЅ•вЂ¦вЂ¦жЇЏеЅ“жњ‰ж­¤з±»з‰№ж®Љдє‹д»¶и§¦еЏ‘ж—¶пјЊе°±дјљз”џж€ђдёЂжќЎи®°еЅ•е№¶е°†е…¶еЉ е…Ґж•°жЌ®еє“дё­пј€ж€–иЂ…пјЊе†™е…Ґж—Ґеї—ж–‡д»¶дё­пј‰гЂ‚иї™дє›еџєзЎЂж•°жЌ®е°±жЇж€‘д»¬еђЋжњџиї›иЎЊдёЂдє›е€†жћђе·ҐдЅњзљ„е‰ЌжЏђгЂ‚</p>

<p>жњ‰дє†еџєзЎЂж•°жЌ®д№‹еђЋпјЊењЁиї›иЎЊе€†жћђд№‹е‰ЌпјЊж€‘д»¬иїйњЂи¦ЃеЇ№е…¶иї›иЎЊдёЂдє›е¤„зђ†пјљ</p>

<ol>
  <li>
    <p><strong>ж•°жЌ®жё…жґ—пјљ</strong>дёєд»Ђд№€и¦Ѓиї›иЎЊж•°жЌ®жё…жґ—е‘ўпјџе› дёєеЋџе§‹зљ„еџєзЎЂж•°жЌ®дё­еЏЇиѓЅе­ењЁдёЂдє›и„Џж•°жЌ®пјЊеЌій‚Јдє›дёЌз¬¦еђ€и§„иЊѓи¦Ѓж±‚зљ„ж•°жЌ®гЂ‚й‚Јд№€пјЊдёєд»Ђд№€дјље­ењЁи„Џж•°жЌ®е‘ўпјџе› дёєдёљеЉЎзі»з»џе·ҐзЁ‹её€ењЁй‡‡й›†иї™дє›ж•°жЌ®зљ„иї‡зЁ‹дё­пјЊеЏЇиѓЅжњ¬иє«е°±е­ењЁдёЂдє›дёЌи§„иЊѓзљ„ењ°ж–№пј›еЏ¦е¤–пјЊдёљеЉЎе·ҐзЁ‹её€ењЁй‡‡й›†ж•°жЌ®ж—¶еЏЇиѓЅе№¶дёЌиѓЅжЏђе‰ЌзџҐйЃ“еђЋз»­зљ„дёљеЉЎе€†жћђдё­еЇ№дєЋж•°жЌ®жњ‰е“Єдє›и¦Ѓж±‚пјЊдѕ‹е¦‚й‡‡й›†иї‡зЁ‹дё­еЏЇиѓЅжџђдє›е­—ж®µдёєз©єпјЊиЂЊе®ћй™…дёљеЉЎи¦Ѓж±‚иЇҐе­—ж®µдёЌиѓЅдёєз©єз­‰з­‰гЂ‚е…·дЅ“и„Џж•°жЌ®зљ„е®љд№‰иїйњЂи¦Ѓз»“еђ€е®ћй™…йЎ№з›®жѓ…е†µжќҐе†іе®љпјЊдѕ‹е¦‚пјље‡єзЋ°з©єе­—ж®µгЂЃй‡Ќе¤Ќи®°еЅ•з­‰гЂ‚е› ж­¤пјЊењЁиї›иЎЊж­ЈејЏе€†жћђд№‹е‰ЌпјЊйњЂи¦Ѓе…€еЇ№еџєзЎЂж•°жЌ®иї›иЎЊж•°жЌ®жё…жґ—гЂ‚</p>
  </li>
  <li>
    <p><strong>ж•°жЌ®йў„е¤„зђ†пјљ</strong>ж‰Ђи°“йў„е¤„зђ†е°±жЇжЏђе‰ЌеЇ№ж•°жЌ®иї›иЎЊдёЂдє›е¤„зђ†пјЊе®ѓжЇз›ёеЇ№ж­ЈејЏе€†жћђиї‡зЁ‹дё­зљ„ж•°жЌ®е¤„зђ†иЂЊиЁЂзљ„гЂ‚дѕ‹е¦‚пјЊеђЋжњџзљ„еѕ€е¤љжЊ‡ж ‡з»џи®ЎйѓЅдѕќиµ–дєЋжџђиЎЊдёєдє§з”џж—¶зљ„ж—Ґжњџпј€YYYY/MM/DDпј‰пјЊдЅ†жЇеџєзЎЂж•°жЌ®дё­зљ„з›ёе…ідїЎжЃЇеЏЄжњ‰е®Њж•ґзљ„ж—¶й—ґж€іеЅўејЏпј€вЂќж—Ґжњџ + ж—¶й—ґвЂњпј‰пјЊиЂЊиЂѓи™‘е€°еђЋжњџеѕ€е¤љењ°ж–№йѓЅйњЂи¦Ѓз”Ёе€°еЌ•з‹¬зљ„ж—ҐжњџдїЎжЃЇпјЊж‰Ђд»Ґж€‘д»¬еЏЇд»ҐењЁеЋџе§‹ж—¶й—ґж€ізљ„еџєзЎЂдёЉпјЊеЇ№е…¶иї›иЎЊйў„е¤„зђ†пјЊз”џж€ђдёЂдёЄж–°зљ„ж—Ґжњџе­—ж®µж–№дѕїеђЋжњџе€†жћђж—¶дЅїз”ЁгЂ‚</p>
  </li>
</ol>

<p>ењЁе®Њж€ђж•°жЌ®жё…жґ—е’Њйў„е¤„зђ†еђЋпјЊж€‘д»¬е°±жќҐе€°дє† <strong>жЊ‡ж ‡дЅ“зі»</strong>пјЊеЌіж€‘д»¬йњЂи¦Ѓз»џи®Ўе€†жћђе“Єдє›жЊ‡ж ‡пјЊе®ѓе…¶е®ћжЇењЁж•ґдёЄйЎ№з›®з»ЏиђҐи®ѕи®Ўй¶ж®µпј€еЌіж­ЈејЏз»ЏиђҐд№‹е‰Ќпј‰е°±еє”иЇҐжЏђе‰Ќжћ„е»єзљ„гЂ‚жњ¬дѕ‹дё­пјЊжЊ‡ж ‡дЅ“зі»зљ„жћ„е»єеџєдєЋ вЂќдєє + иґ§ + ењєвЂњ зђ†и®єпјљвЂќдєєвЂњ жЊ‡зљ„жЇз”µе•†е№іеЏ°зљ„з”Ёж€·пјЊвЂќиґ§вЂњ жЊ‡зљ„жЇз”µе•†е№іеЏ°зљ„дє§е“ЃпјЊвЂќењєвЂњ жЊ‡зљ„жЇз”µе•†е№іеЏ°жњ¬иє«гЂ‚д№џе°±жЇиЇґпјЊж€‘д»¬йњЂи¦Ѓе€†е€«еЇ№з”Ёж€·гЂЃе•†е“ЃгЂЃе№іеЏ°иї›иЎЊж•°жЌ®е€†жћђгЂ‚</p>

<p>жЋҐдё‹жќҐпјЊж€‘д»¬жќҐзњ‹дёЂдё‹й’€еЇ№з”Ёж€·гЂЃе•†е“ЃгЂЃе№іеЏ°пјЊйѓЅжњ‰е“Єдє›е…·дЅ“жЊ‡ж ‡йњЂи¦Ѓиї›иЎЊе€†жћђпјљ</p>

<ul>
  <li>
    <p>й¦–е…€пјЊй’€еЇ№з”Ёж€·пјЊж€‘д»¬еЏЇд»Ґиї›иЎЊ <strong>PV</strong> е’Њ <strong>UV</strong> зљ„и®Ўз®—пјЊиї™й‡Њ PVпј€Page Viewпј‰жЊ‡зљ„жЇи®їй—®ж¬Ўж•°пјЊеЌідёЂе®љж—¶й—ґе†…жџђдёЄйЎµйќўзљ„жµЏи§€ж¬Ўж•°пј›UVпј€Unique Visitorпј‰жЊ‡зљ„жЇи®їй—®дєєж•°пјЊеЌідёЂе®љж—¶й—ґе†…и®їй—®жџђдёЄйЎµйќўзљ„дєєж•°гЂ‚ з„¶еђЋпјЊж€‘д»¬иїеЏЇд»Ґи®Ўз®— <strong>з•™е­</strong>пјЊе®ѓжЊ‡зљ„жЇжџђдёЂдёЄз»џдёЂж—¶ж®µе†…ж–°еўћзљ„з”Ёж€·ж•°дё­пјЊз»Џиї‡дёЂж®µж—¶й—ґеђЋд»ЌењЁдЅїз”Ёж€‘д»¬зЅ‘з«™ж€–иЂ… APP зљ„з”Ёж€·еЌ еЅ“е€ќж–°еўћз”Ёж€·зљ„жЇ”дѕ‹гЂ‚ е†Ќе°±жЇ <strong>иґ­д№°иЎЊдёє</strong> зљ„и®Ўз®—пјЊеЌіз”Ёж€·иґ­д№°дє†д»Ђд№€е•†е“ЃгЂЃе±ћдєЋд»Ђд№€е“Ѓз±»гЂЃиґ­д№°й‡ЏжЇе¤ље°‘з­‰з­‰гЂ‚з„¶еђЋпјЊж€‘д»¬иїеЏЇд»ҐдЅїз”Ё <strong>RFM жЁЎећ‹</strong> иї›иЎЊз»џи®ЎпјЊе®ѓжЇдёЂз§Ќз”ЁдєЋиЎЎй‡ЏеЅ“е‰Ќз”Ёж€·д»·еЂје’Њз”Ёж€·жЅњењЁд»·еЂјзљ„е·Ґе…·пјЊеЌіеЅ“е‰Ќз”Ёж€·еЇ№е№іеЏ°дє§з”џдє†е¤ље°‘иґЎзЊ®пјЊд»ҐеЏЉд»–д»¬жњЄжќҐдјљеЇ№е№іеЏ°дє§з”џе¤ље°‘иґЎзЊ®пјЊжЇеђ¦е±ћдєЋй«д»·еЂјз”Ёж€·з­‰гЂ‚йЂљиї‡ RFM жЁЎећ‹пјЊж€‘д»¬еЏЇд»ҐеЇ№з›®ж ‡з”Ёж€·иї›иЎЊзІѕе‡†е®љдЅЌгЂ‚</p>
  </li>
  <li>
    <p>з„¶еђЋпјЊй’€еЇ№е•†е“ЃпјЊж€‘д»¬еЏЇд»Ґи®Ўз®—жџђе•†е“Ѓзљ„ <strong>з‚№е‡»й‡Џ</strong>гЂЃ<strong>ж”¶и—Џй‡Џ</strong>гЂЃ<strong>еЉ е…Ґиґ­з‰©иЅ¦зљ„ж•°й‡Џ</strong>гЂЃ<strong>иґ­д№°й‡Џ</strong>гЂЃ<strong>иґ­д№°иЅ¬еЊ–зЋ‡</strong> з­‰гЂ‚</p>
  </li>
  <li>
    <p>жњЂеђЋпјЊй’€еЇ№е№іеЏ°пјЊж€‘д»¬еЏЇд»ҐеЇ№е•†е“Ѓиў«жµЏи§€гЂЃж”¶и—ЏгЂЃж·»еЉ е€°иґ­з‰©иЅ¦гЂЃжњЂз»€иґ­д№° вЂ”вЂ” иї™з±»ењЁж•ґдёЄжµЃзЁ‹дё­жЇ”иѕѓй‡Ќи¦Ѓзљ„дёЂдє›иЉ‚з‚№ж•°жЌ®иї›иЎЊе€†жћђпјЊи®Ўз®— <strong>жЇЏдёЄзЋЇиЉ‚зљ„иЅ¬еЊ–зЋ‡</strong> жЇе¤ље°‘пјЊзњ‹дёЂдё‹жЇеђ¦е…¶дё­жџђдёЄзЋЇиЉ‚е­ењЁй—®йўпј€зі»з»џеЉџиѓЅгЂЃз”Ёж€·дЅ“йЄЊз­‰пј‰пјЊе№¶й’€еЇ№иЇҐзЋЇиЉ‚иї›иЎЊ <strong>еЉџиѓЅдјеЊ–</strong>гЂ‚</p>
  </li>
</ul>

<p>е› ж­¤пјЊдёЉе›ѕеЏЌж е‡єдє†жњ¬жЎ€дѕ‹дё­зљ„дёљеЉЎжµЃзЁ‹гЂ‚дёЂи€¬з»Џе…ёзљ„з”µе•†з±»ж•°жЌ®е€†жћђжµЃзЁ‹еџєжњ¬йѓЅдёЋд№‹з±»дјјпјЊеЌіпјљ</p>

<p>еџєзЎЂж•°жЌ® $\longrightarrow$ ж•°жЌ®жё…жґ—гЂЃйў„е¤„зђ† $\longrightarrow$ вЂњдєєиґ§ењєвЂќ жЊ‡ж ‡дЅ“зі» $\longrightarrow$ з»џи®Ўеђ„з§ЌжЊ‡ж ‡ $\longrightarrow$ ж №жЌ®иї™дє›жЊ‡ж ‡жќҐе€†жћђжЊ‡еЇјеђЋжњџиїђиђҐз­–з•Ґ</p>

<h2 id="3-дЅї-иґ§ењє-ж‹†и§ЈејЏе»єжЊ‡ж ‡дЅ“зі»">3. дЅївЅ¤ вЂњвј€иґ§ењєвЂќ ж‹†и§ЈвЅ…ејЏе»євЅґжЊ‡ж ‡дЅ“зі»</h2>

<p><strong>жњЂз»€з»“жћњпјљиЇ„д»· вЂњвЅ¤ж€·гЂЃе•†е“ЃгЂЃе№іеЏ°вЂњ дё‰иЂ…зљ„иґЁй‡Џ</strong></p>

<p><strong>вј€иґ§ењєпјљ</strong></p>

<ul>
  <li>
    <p><strong>вЂњдєєвЂќпј€вЅ¤ж€·пј‰</strong>жЇж•ґдёЄиїђиђҐзљ„ж ёвјјгЂ‚ж‰Ђжњ‰дёѕеЉЁйѓЅе›ґз»•зќЂпјЊе¦‚дЅ•и®©ж›ґе¤љзљ„вј€жњ‰иґ­д№°вѕЏдёєпјЊи®©д»–д»¬д№°зљ„ж›ґе¤љпјЊд№°зљ„ж›ґиґµгЂ‚ж‰Ђд»ҐеЇ№вј€зљ„жґћеЇџжЇвјЂе€‡вѕЏдёєзљ„еџєзЎЂгЂ‚вЅ¬е‰Ќе№іеЏ°дёЉзљ„дё»вј’ж¶€иґ№вј€зѕ¤пј€з”Ёж€·пј‰жњ‰е“Єдє›з‰№еѕЃпјЊд»–д»¬еЇ№иґ§пј€е•†е“Ѓпј‰жњ‰е“Єдє›йњЂж±‚пјЊд»–д»¬жґ»и·ѓењЁе“Єдє›ењєпј€е№іеЏ°пј‰пјЊиїжњ‰е“Єдє›жњ‰ж¶€иґ№вј’зљ„вј€вЅ¬е‰ЌдёЌењЁе№іеЏ°дёЉпјЊеЇ№иї™дє›й—®йўзљ„е›ћз­”жЊ‡еђ‘дє†жЋҐдё‹жќҐзљ„вѕЏеЉЁгЂ‚</p>

    <p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-06-30-%E4%BA%BA%EF%BC%88%E7%94%A8%E6%88%B7%EF%BC%89-1.png" width="100%" /></p>
  </li>
  <li>
    <p><strong>вЂњиґ§вЂќ пј€е•†е“Ѓпј‰</strong>е°±еЇ№еє”дѕ›з»™пјЊж¶‰еЏЉе€°дє†иґ§е“Ѓе€†е±‚пјЊе“Єдє›жЇзєўжµ·пј€й”Ђй‡Џй«гЂЃе€©ж¶¦е°‘гЂЃз«ћдє‰е¤љпј‰пјЊе“Єдє›жЇи“ќжµ·пј€й”Ђй‡Џе°‘гЂЃе€©ж¶¦й«гЂЃз«ћдє‰е°‘пј‰пјЊе¦‚дЅ•иї›вѕЏеЉЁжЂЃи°ѓж•ґпјЊжЇи¦ЃеЃљвѕѓиђҐиїжЇе№іеЏ°пјЊд»Ґж»Ўвѕњж¶€иґ№иЂ…зљ„йњЂж±‚пј€жњЂз»€з›®зљ„иїжЇиїЅж±‚е№іеЏ°е€©з›ЉжњЂе¤§еЊ–пј‰гЂ‚</p>
  </li>
  <li>
    <p><strong>вЂњењєвЂќпј€е№іеЏ°пј‰</strong>е°±жЇж¶€иґ№иЂ…ењЁд»Ђд№€ењєж™Їдё‹пјЊд»Ґд»Ђд№€ж ·зљ„вЅ…ејЏжЋҐи§¦е€°дє†иї™дёЄе•†е“ЃгЂ‚е№іеЏ°еЏЇд»Ґзђ†и§Јдёєе°±жЇз”µе•†зЅ‘з«™пјЊдЅ†жЇзЋ°ењЁиї™дёЄ вЂњењєвЂќ зљ„ж¦‚еїµе·Із»Џе‰ЌеђЋжњ‰ж‰Ђе»¶дјёпјЊеѕЂе‰Ќе»¶дјёжЊ‡зљ„жЇжЋЁе№їеј•жµЃз­‰пјЊеѕЂеђЋе»¶дјёжЊ‡зљ„жЇз‰©жµЃгЂЃе”®еђЋз­‰гЂ‚ж—©жњџзљ„еЇјиґ­пј€еј•жµЃпј‰еЃљзљ„вЅђиѕѓз®ЂеЌ•пјЊвЅ¬е‰Ќзљ„ењєе°±вЅђиѕѓдё°еЇЊпјЊдЅ†д№џжљґйњІдє†ж·е®ќе’Њдє¬дёњењЁеЇјиґ­вЅ…вѕЇзљ„вјЂдє›й—®йўгЂ‚вЅђе¦‚е†…е®№иђҐй”ЂпјЊвЅ¬е‰ЌжњЂеҐЅзљ„еЏЇиѓЅжЇеѕ®дїЎзљ„ KOLпј€е…ій”®ж„Џи§Ѓйў†иў–пјЊдѕ‹е¦‚пјљзЅ‘зєўгЂЃе¤§ V з­‰пј‰ вЅЈжЂЃе’Њвј©зєўд№¦пјЊз”љвѕ„еѕ®еЌљпјЊвЅЅдёЌењЁз”µе•†вѕѓвј°зљ„ењєгЂ‚е¦‚дЅ•еЃљвјЂдёЄе…Ёеџџзљ„ж‰“йЂљпјЊе’Њж¶€иґ№иЂ…иї›вѕЏе¤љи§¦з‚№зљ„жЋҐи§¦пјЊвЅђе¦‚з¤ѕдє¤е’Њз”µе•†иЃ”еЉЁпјЊжќҐе®Њж€ђй”Ђе”®иЅ¬еЊ–пјЊиї™е°±жЇи…ѕи®Їе’ЊйївѕҐвјЂз›ґйѓЅењЁи®Ізљ„ вЂње…ЁеџџиђҐй”ЂвЂќгЂ‚</p>
  </li>
</ul>

<h2 id="4-зЎ®и®¤й—®йў">4. зЎ®и®¤й—®йў</h2>

<p>жњ¬ж¬Ўе€†жћђзљ„вЅ¬зљ„жЇжѓійЂљиї‡еЇ№вЅ¤ж€·вѕЏдёєж•°жЌ®иї›вѕЏе€†жћђпјЊдёєд»Ґдё‹й—®йўжЏђдѕ›и§Јй‡Ље’Њж”№иї›е»єи®®пјљ</p>

<ol>
  <li>
    <p>еџєдєЋжјЏвЅѓжЁЎећ‹зљ„вЅ¤ж€·иґ­д№°жµЃзЁ‹еђ„зЋЇиЉ‚е€†жћђжЊ‡ж ‡пјЊзЎ®е®љеђ„дёЄзЋЇиЉ‚зљ„иЅ¬жЌўзЋ‡пјЊдѕїдєЋж‰ѕе€°йњЂи¦Ѓж”№иї›зљ„зЋЇиЉ‚пј›</p>
  </li>
  <li>
    <p>е•†е“Ѓе€†жћђпјљж‰ѕе‡єзѓ­й”Ђе•†е“ЃпјЊз ”з©¶зѓ­й”Ђе•†е“Ѓз‰№з‚№пј›</p>
  </li>
  <li>
    <p>еџєдєЋ RFM жЁЎећ‹ж‰ѕе‡єж ёвјјд»иґ№вЅ¤ж€·зѕ¤пјЊеЇ№иї™йѓЁе€†вЅ¤ж€·иї›вѕЏзІѕе‡†иђҐй”Ђпј€иї›дёЂж­ҐжЊ–жЋ / жЊЅз•™пј‰гЂ‚</p>
  </li>
</ol>

<h2 id="5-е‡†е¤‡дЅњ">5. е‡†е¤‡вјЇдЅњ</h2>

<h3 id="51-ж•°жЌ®иЇ»еЏ–ж€·дёєж•°жЌ®">5.1 ж•°жЌ®иЇ»еЏ–пј€вЅ¤ж€·вѕЏдёєж•°жЌ®пј‰</h3>

<p><strong>иЎЁз»“жћ„пјљ</strong></p>

<table>
  <thead>
    <tr>
      <th>е€—еђЌ</th>
      <th>иЇґжЋ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user_id</td>
      <td>вЅ¤ж€· ID</td>
    </tr>
    <tr>
      <td>item_id</td>
      <td>е•†е“Ѓ ID</td>
    </tr>
    <tr>
      <td>behavior_type</td>
      <td>вЅ¤ж€·вѕЏдёєз±»ећ‹пј€1-ж›ќе…‰пј›2-иґ­д№°пј›3-еЉ вјЉиґ­з‰©в»‹пј›4-еЉ вјЉж”¶и—Џе¤№гЂ‚пј‰</td>
    </tr>
    <tr>
      <td>user_geohash</td>
      <td>ењ°зђ†дЅЌзЅ®</td>
    </tr>
    <tr>
      <td>item_category</td>
      <td>е“Ѓз±» ID</td>
    </tr>
    <tr>
      <td>time</td>
      <td>вЅ¤ж€·вѕЏдёєеЏ‘вЅЈзљ„ж—¶й—ґ</td>
    </tr>
  </tbody>
</table>

<p><strong>еџєзЎЂж•°жЌ®пј€йѓЁе€†пј‰пјљ</strong></p>

<table>
  <thead>
    <tr>
      <th>user_id</th>
      <th>item_id</th>
      <th>behavior_type</th>
      <th>user_geohash</th>
      <th>item_category</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>98047837</td>
      <td>232431562</td>
      <td>1</td>
      <td>В </td>
      <td>4245</td>
      <td>2019-12-06 02</td>
    </tr>
    <tr>
      <td>97726136</td>
      <td>383583590</td>
      <td>1</td>
      <td>В </td>
      <td>5894</td>
      <td>2019-12-09 20</td>
    </tr>
    <tr>
      <td>98607707</td>
      <td>64749712</td>
      <td>1</td>
      <td>В </td>
      <td>2883</td>
      <td>2019-12-18 11</td>
    </tr>
    <tr>
      <td>98662432</td>
      <td>320593836</td>
      <td>1</td>
      <td>96nn52n</td>
      <td>6562</td>
      <td>2019-12-06 10</td>
    </tr>
    <tr>
      <td>98145908</td>
      <td>290208520</td>
      <td>1</td>
      <td>В </td>
      <td>13926</td>
      <td>2019-12-16 21</td>
    </tr>
    <tr>
      <td>93784494</td>
      <td>337869048</td>
      <td>1</td>
      <td>В </td>
      <td>3979</td>
      <td>2019-12-03 20</td>
    </tr>
    <tr>
      <td>94832743</td>
      <td>105749725</td>
      <td>1</td>
      <td>В </td>
      <td>9559</td>
      <td>2019-12-13 20</td>
    </tr>
    <tr>
      <td>95290487</td>
      <td>76866650</td>
      <td>1</td>
      <td>В </td>
      <td>10875</td>
      <td>2019-11-27 16</td>
    </tr>
    <tr>
      <td>96610296</td>
      <td>161166643</td>
      <td>1</td>
      <td>В </td>
      <td>3064</td>
      <td>2019-12-11 23</td>
    </tr>
    <tr>
      <td>100684618</td>
      <td>21751142</td>
      <td>3</td>
      <td>В </td>
      <td>2158</td>
      <td>2019-12-05 23</td>
    </tr>
    <tr>
      <td>100509623</td>
      <td>266020206</td>
      <td>3</td>
      <td>tfvomgk</td>
      <td>4923</td>
      <td>2019-12-08 17</td>
    </tr>
    <tr>
      <td>вЂ¦</td>
      <td>вЂ¦</td>
      <td>вЂ¦</td>
      <td>вЂ¦</td>
      <td>вЂ¦</td>
      <td>вЂ¦</td>
    </tr>
  </tbody>
</table>

<p>жіЁж„ЏпјљеџєзЎЂж•°жЌ®дё­зљ„ж—¶й—ґж јејЏдёє <code class="language-plaintext highlighter-rouge">е№ґ-жњ€-ж—Ґ е°Џж—¶пј€24 е°Џж—¶е€¶пј‰</code>пјЊдѕ‹е¦‚пјљ<code class="language-plaintext highlighter-rouge">2019-12-06 02</code>гЂ‚</p>

<p>е€›е»єж•°жЌ®иЎЁпјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1">-- е€›е»єж•°жЌ®иЎЁ</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">o_retailers_trade_user</span> <span class="p">(</span>
  <span class="n">user_id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
  <span class="n">item_id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
  <span class="n">behavior_type</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">user_geohash</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span>
  <span class="n">item_category</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
  <span class="nb">time</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> 
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>еЇје…Ґж•°жЌ®пјљ</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-06-30-iShot2021-07-01%2000.08.29.png" width="60%" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">-- жџҐзњ‹еџєзЎЂж•°жЌ®</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">o_retailers_trade_user</span> <span class="k">LIMIT</span> <span class="mi">11</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-06-30-iShot2021-07-01%2000.13.13.png" width="68%" /></p>

<h3 id="52-ж•°жЌ®йў„е¤„зђ†">5.2 ж•°жЌ®йў„е¤„зђ†</h3>

<p>еўћеЉ ж–°е€— <code class="language-plaintext highlighter-rouge">date_time (DATETIME)</code>гЂЃ<code class="language-plaintext highlighter-rouge">dates (CHAR)</code>пјЊдѕїдєЋеђЋз»­ж—¶й—ґз»ґеє¦е€†жћђпјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">-- еўћеЉ ж–°е­—ж®µ date_timeпјЊе­—ж®µж•°жЌ®жќҐи‡ЄеџєзЎЂж•°жЌ®дё­зљ„ time е­—ж®µ</span>
<span class="c1">-- %H еЏЇд»ҐиЎЁз¤є 0-23пј›вЅЅ %h иЎЁз¤є 0-12</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">o_retailers_trade_user</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">date_time</span> <span class="nb">DATETIME</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">o_retailers_trade_user</span> <span class="k">SET</span> <span class="n">date_time</span> <span class="o">=</span> <span class="n">STR_TO_DATE</span><span class="p">(</span><span class="nb">time</span><span class="p">,</span> <span class="s1">'%Y-%m-%d %H'</span><span class="p">);</span>

<span class="c1">-- еўћеЉ ж–°е­—ж®µ datesпјЊе­—ж®µж•°жЌ®жќҐи‡ЄдёЉйќўж–°еўћзљ„ date_time е­—ж®µ</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">o_retailers_trade_user</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">dates</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">o_retailers_trade_user</span> <span class="k">SET</span> <span class="n">dates</span> <span class="o">=</span> <span class="nb">DATE</span><span class="p">(</span><span class="n">date_time</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>жџҐзњ‹ж›ґж–°еђЋзљ„иЎЁз»“жћ„е’Њж•°жЌ®пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">-- жџҐзњ‹ж›ґж–°еђЋзљ„иЎЁз»“жћ„</span>
<span class="k">DESC</span> <span class="n">o_retailers_trade_user</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-01%2020.23.45.png" width="50%" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">-- жџҐзњ‹ж›ґж–°еђЋзљ„ж•°жЌ®</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">o_retailers_trade_user</span> <span class="k">LIMIT</span> <span class="mi">11</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-01%2020.25.32.png" width="90%" /></p>

<p>й‡Ќе¤ЌеЂје¤„зђ†пјље€›е»єж–°иЎЁ <code class="language-plaintext highlighter-rouge">temp_trade</code>пјЊе№¶еђ‘е…¶дё­жЏ’вјЉеЋ»й‡ЌеђЋзљ„ж•°жЌ®</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">-- е€›е»єж–°иЎЁ temp_tradeпјЊе№¶еђ‘е…¶дё­жЏ’вјЉеЋ»й‡ЌеђЋзљ„ж•°жЌ®</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">temp_trade</span> <span class="k">LIKE</span> <span class="n">o_retailers_trade_user</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">temp_trade</span> <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">o_retailers_trade_user</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="6-жЊ‡ж ‡дЅ“зі»е»єи®ѕ">6. жЊ‡ж ‡дЅ“зі»е»єи®ѕ</h2>

<p><strong>вЂњвј€ иґ§ ењєвЂќ жЊ‡ж ‡дЅ“зі»</strong></p>

<h3 id="61-ж€·жЊ‡ж ‡дЅ“зі»">6.1 вЅ¤ж€·жЊ‡ж ‡дЅ“зі»</h3>

<p><strong>еџєзЎЂжЊ‡ж ‡дЅ“зі»пј€UV / PV / з•™е­зЋ‡пј‰+ RFM жЁЎећ‹е€†жћђ</strong></p>

<h4 id="611-еџєзЎЂжЊ‡ж ‡">6.1.1 еџєзЎЂжЊ‡ж ‡</h4>

<p><strong>UVгЂЃPVгЂЃжµЏи§€ж·±еє¦з»џи®Ў</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="cm">/*
pvпјљз»џи®Ў behavior_type = 1 зљ„и®°еЅ•ж•°й‡ЏпјЊйњЂи¦ЃжЊ‰ж—Ґз»џи®Ўпј€е€†з»„пј‰
uvпјљз»џи®Ў DISTINCT user_id зљ„ж•°й‡ЏпјЊйњЂи¦ЃжЊ‰вЅ‡з»џи®Ўпј€е€†з»„пј‰
жµЏи§€ж·±еє¦пјљpv/uv

жіЁж„Џпјљpv иї›вѕЏ COUNT зљ„ж—¶еЂ™пјЊе¦‚жћњ behavior_type = 1 е€™иї›вѕЏи®Ўз®—пј›еђ¦е€™пјЊдёЌиї›вѕЏи®Ўз®—
*/</span>

<span class="k">SELECT</span> <span class="n">dates</span><span class="p">,</span> 
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">uv</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">pv</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="o">/</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="s1">'pv/uv'</span>
<span class="k">FROM</span> <span class="n">temp_trade</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dates</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-01%2021.18.42.png" width="33%" /></p>

<p><strong>з•™е­зЋ‡пј€жЊ‰ж—Ґпј‰з»џи®Ў</strong></p>

<p>жіЁж„Џпјљз•™е­зЋ‡еЏЇд»Ґе€†дёєеѕ€е¤љз§ЌпјЊдѕ‹е¦‚пјљж–°жіЁе†Њз”Ёж€·з•™е­зЋ‡гЂЃжґ»и·ѓз”Ёж€·з•™е­зЋ‡з­‰гЂ‚з”±дєЋжњ¬жЎ€дѕ‹дё­зљ„ж•°жЌ®е№¶жІЎжњ‰еЊ…еђ«з”Ёж€·жіЁе†Њз›ёе…ідїЎжЃЇпјЊе› ж­¤иї™й‡Њж€‘д»¬з»џи®Ўзљ„жЇжґ»и·ѓз”Ёж€·з•™е­зЋ‡гЂ‚</p>

<p>дѕ‹е¦‚пјљ</p>

<table>
  <thead>
    <tr>
      <th>еџєе‡†ж—Ґжњџ</th>
      <th>еЅ“ж—Ґжґ»и·ѓз”Ёж€·</th>
      <th>1 е¤©д»ҐеђЋжґ»и·ѓз”Ёж€·</th>
      <th>2 е¤©д»ҐеђЋжґ»и·ѓз”Ёж€·</th>
      <th>вЂ¦вЂ¦</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2019-12-28</td>
      <td>100 дєє</td>
      <td>90 дєєпј€90%пј‰</td>
      <td>80 дєєпј€80%пј‰</td>
      <td>вЂ¦вЂ¦</td>
    </tr>
    <tr>
      <td>вЂ¦вЂ¦</td>
      <td>вЂ¦вЂ¦</td>
      <td>вЂ¦вЂ¦</td>
      <td>вЂ¦вЂ¦</td>
      <td>вЂ¦вЂ¦</td>
    </tr>
  </tbody>
</table>

<p>ж€‘д»¬йњЂи¦Ѓпјљ</p>

<ol>
  <li>
    <p>иЋ·еЏ–е€°дёЂдёЄз±»дјјдёЉйќўзљ„з»“жћњй›†</p>
  </li>
  <li>
    <p>еџєзЎЂж•°жЌ®дё­ж‰Ђжњ‰зљ„ж—ҐжњџйѓЅеє”иЇҐиї›иЎЊе¦‚дёЉзљ„и®Ўз®—</p>
  </li>
</ol>

<p>дѕ‹е¦‚пјЊеЇ№дєЋ ID дёє <code class="language-plaintext highlighter-rouge">98047837</code> зљ„з”Ёж€·пјЊд»Ґ <code class="language-plaintext highlighter-rouge">2019-12-28</code> дёєеџєе‡†ж—Ґжњџи®Ўз®—д№‹еђЋдёЂж®µж—¶й—ґе†…зљ„ж—Ґжґ»и·ѓзЋ‡пјЊж€‘д»¬йњЂи¦ЃењЁж•°жЌ®й›†дё­ж‰ѕе€°иЇҐз”Ёж€· <code class="language-plaintext highlighter-rouge">2019-12-28</code> д№‹еђЋзљ„ж•°жЌ®пјЊеЌіпјљ</p>

<table>
  <thead>
    <tr>
      <th>user_id</th>
      <th>dates</th>
      <th>dates_after</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>98047837</td>
      <td>2019-12-28</td>
      <td>2019-12-29пј€е¦‚жћњиЇҐз”Ёж€· 29 ж—Ґиї™е¤©и®°еЅ•е­ењЁпјЊй‚Јд№€иЇҐз”Ёж€·ењЁ 29 ж—Ґиї™е¤©е°±жЇжґ»и·ѓзљ„пј‰</td>
    </tr>
    <tr>
      <td>98047837</td>
      <td>2019-12-28</td>
      <td>2019-12-30пј€еђЊдёЉпј‰</td>
    </tr>
    <tr>
      <td>вЂ¦вЂ¦</td>
      <td>вЂ¦вЂ¦</td>
      <td>вЂ¦вЂ¦</td>
    </tr>
  </tbody>
</table>

<p>е› ж­¤пјЊеЇ№дєЋиЇҐз”Ёж€·пјЊж€‘д»¬йЂљиї‡и®Ўз®— пј€<code class="language-plaintext highlighter-rouge">dates_after</code> пјЌ <code class="language-plaintext highlighter-rouge">dates</code>пј‰еѕ—е€°жџђеђЋз»­ж—ҐжњџдёЋеџєе‡†ж—Ґжњџз›ёе·®зљ„е¤©ж•°пјЊе¦‚жћњз»“жћњз­‰дєЋпјљ</p>

<ul>
  <li>1 е¤©пјЊж€‘д»¬е°±еє”иЇҐењЁи®Ўз®— вЂњ1 е¤©д»ҐеђЋжґ»и·ѓз”Ёж€·вЂќ зљ„ж—¶еЂ™ пј‹1пјЊж€–иЂ…иї›иЎЊ <code class="language-plaintext highlighter-rouge">COUNT()</code> и®Ўж•°пј›</li>
  <li>2 е¤©пјЊж€‘д»¬е°±еє”иЇҐењЁи®Ўз®— вЂњ2 е¤©д»ҐеђЋжґ»и·ѓз”Ёж€·вЂќ зљ„ж—¶еЂ™ пј‹1пјЊж€–иЂ…иї›иЎЊ <code class="language-plaintext highlighter-rouge">COUNT()</code> и®Ўж•°пј›</li>
  <li>вЂ¦вЂ¦</li>
</ul>

<p>з„¶еђЋпјЊж€‘д»¬иЇҐе¦‚дЅ•еѕ—е€°е¦‚е‰Ќйќўе±•з¤єзљ„еђЊж—¶еЊ…еђ« вЂњеЅ“ж—Ґжґ»и·ѓз”Ёж€·вЂќгЂЃвЂњ1 е¤©д»ҐеђЋжґ»и·ѓз”Ёж€·вЂќгЂЃвЂњ2 е¤©д»ҐеђЋжґ»и·ѓз”Ёж€·вЂќ з­‰е­—ж®µзљ„иЎЁз»“жћ„е‘ўпјџ</p>

<p>ж€‘д»¬еЏЇд»ҐдЅїз”Ё <strong>и‡Єе…іиЃ”</strong> зљ„ж–№ејЏжќҐе®Њж€ђпјљ</p>

<p>й¦–е…€пјЊж€‘д»¬еЏЇд»Ґе…€д»Ћ <code class="language-plaintext highlighter-rouge">temp_trade</code> иЎЁдё­з­›йЂ‰е‡є <code class="language-plaintext highlighter-rouge">user_id</code> е’Њ <code class="language-plaintext highlighter-rouge">dates</code> е­—ж®µпјЊе№¶жЊ‰з…§иї™дё¤дёЄе­—ж®µе€†з»„гЂ‚иї™з§Ќжѓ…е†µдё‹пјЊжџђз”Ёж€·ењЁжџђе¤©еЌідЅїе­ењЁе¤љжќЎи®°еЅ•д№џеЏЄиї”е›ћдёЂжќЎпјЊеЌіиЎЁжЋиЇҐз”Ёж€·ењЁиї™е¤©жЇжґ»и·ѓзљ„пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-01%2023.08.14.png" width="19%" /></p>

<p>еЏЇд»Ґзњ‹е€°пјЊеѕ—е€°зљ„з»“жћњдёЋж€‘д»¬д№‹е‰Ќж‰Ђжњџжњ›зљ„ж•°жЌ®й›†иїе·®дёЂдёЄ <code class="language-plaintext highlighter-rouge">dates_after</code> е­—ж®µпјЊдё‹йќўж€‘д»¬е°ќиЇ•йЂљиї‡и‡Єе…іиЃ”зљ„ж–№ејЏжќҐеѕ—е€°иЇҐж—Ґжњџпјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> 
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span>
  <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-01%2023.14.44.png" width="38%" /></p>

<p>зЋ°ењЁпјЊж€‘д»¬еѕ—е€°дє†дё¤дёЄж—Ґжњџе­—ж®µпјЊдЅ†жЇж€‘д»¬еЏ‘зЋ°жџђдє›и®°еЅ•дё­пјЊз¬¬дєЊдёЄж—Ґжњџе­—ж®µжЇ”з¬¬дёЂдёЄж—Ґжњџе­—ж®µе°ЏпјЊдѕ‹е¦‚з¬¬ 2 иЎЊдё­пјЊ<code class="language-plaintext highlighter-rouge">dates</code> дёє <code class="language-plaintext highlighter-rouge">2019-12-06</code>пјЊиЂЊ <code class="language-plaintext highlighter-rouge">dates(1)</code> дёє <code class="language-plaintext highlighter-rouge">2019-11-20</code>гЂ‚з”±дєЋж€‘д»¬еёЊжњ›и®Ўз®—зљ„жЇеџєе‡†ж—ҐжњџеЅ“е¤©зљ„жґ»и·ѓз”Ёж€·ж•°пјЊд»ҐеЏЉд№‹еђЋдёЂж®µж—¶й—ґе†…зљ„жґ»и·ѓз”Ёж€·з•™е­зЋ‡пјЊе› ж­¤з¬¬дєЊдёЄж—Ґжњџе­—ж®µеє”иЇҐи¦Ѓе¤§дєЋж€–иЂ…з­‰дєЋз¬¬дёЂдёЄж—Ґжњџе­—ж®µпј€з„¶еђЋе†Ќи®Ўз®—дё¤дёЄж—Ґжњџд№‹й—ґз›ёе·®зљ„е¤©ж•°пј‰гЂ‚ж‰Ђд»ҐпјЊж€‘д»¬иїйњЂи¦ЃйЂљиї‡ <code class="language-plaintext highlighter-rouge">WHERE</code> жќЎд»¶еЇ№дёЉйќўзљ„з»“жћњй›†иї›иЎЊиї‡ж»¤пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> 
  <span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> 
  <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> 
  <span class="n">b</span><span class="p">.</span><span class="n">dates</span> <span class="k">AS</span> <span class="n">dates_after</span> 
<span class="k">FROM</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span>
  <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">dates</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-01%2023.47.37.png" width="30%" /></p>

<p>еЃ‡и®ѕж€‘д»¬еёЊжњ›жњЂз»€еѕ—е€°зљ„ж•°жЌ®й›†дё­еЊ…еђ«д»Ґдё‹е­—ж®µпјљ</p>

<ul>
  <li>еџєе‡†ж—Ґжњџ</li>
  <li>жґ»и·ѓз”Ёж€·ж•°</li>
  <li>1 ж—Ґз•™е­зЋ‡</li>
  <li>2 ж—Ґз•™е­зЋ‡</li>
  <li>вЂ¦вЂ¦</li>
  <li>7 ж—Ґз•™е­зЋ‡</li>
  <li>15 ж—Ґз•™е­зЋ‡</li>
  <li>30 ж—Ґз•™е­зЋ‡</li>
</ul>

<p>й¦–е…€пјЊеЇ№дєЋжґ»и·ѓз”Ёж€·ж•°пјЊж€‘д»¬еЏЇд»ҐењЁдёЉиЎЁзљ„еџєзЎЂдёЉпјЊеЇ№еџєе‡†ж—Ґжњџиї›иЎЊе€†з»„з»џи®Ўеѕ—е€°пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> 
  <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">user_count</span>
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span>
  <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">dates</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-02%2000.10.34.png" width="21%" /></p>

<p>зЋ°ењЁпјЊж€‘д»¬е·Із»Џеѕ—е€°дє†з›®ж ‡з»“жћњй›†дё­зљ„е‰Ќдё¤дёЄе­—ж®µгЂ‚жѕз„¶пјЊеђЋз»­зљ„ 1 ж—Ґз•™е­зЋ‡гЂЃ2 ж—Ґз•™е­зЋ‡вЂ¦вЂ¦30 ж—Ґз•™е­зЋ‡зљ„и®Ўз®—жЁЎејЏжЇз›ёеђЊзљ„гЂ‚иЂЊж€‘д»¬зџҐйЃ“пјЊжџђж—Ґз•™е­зЋ‡ пјќ еЅ“ж—Ґз•™е­ж•° / еџєе‡†ж—Ґжњџжґ»и·ѓж•°пјЊж‰Ђд»Ґж€‘д»¬е…€и®Ўз®—еЇ№еє”ж—Ґжњџзљ„з•™е­ж•°пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> 
  <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">user_count</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_1</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_2</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_3</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_4</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_5</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_6</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_7</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_15</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_30</span>
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span>
  <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">dates</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-02%2000.15.41.png" width="87%" /></p>

<p>з„¶еђЋпјЊеџєдєЋжџђж—Ґз•™е­ж•°пјЊж€‘д»¬е°±еЏЇд»Ґи®Ўз®—е‡єеЅ“ж—Ґзљ„з•™е­зЋ‡гЂ‚дёєдє†дѕїдєЋеђЋз»­и®Ўз®—пјЊж€‘д»¬еЏЇд»Ґе°†дёЉйќўзљ„ <code class="language-plaintext highlighter-rouge">SELECT</code> иЇ­еЏҐдїќе­дёєи§†е›ѕпј€ж€–иЂ…йЂљиї‡ <code class="language-plaintext highlighter-rouge">WITH AS</code> иЇ­еЏҐе€›е»єдёґж—¶иЎЁпјЊд»ҐдѕїењЁеђЊдёЂжќЎ SQL иЇ­еЏҐе†…иї›иЎЊй‡Ќе¤Ќи°ѓз”Ёпј‰пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">user_remain_view</span> <span class="k">AS</span>
<span class="k">SELECT</span> 
  <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">user_count</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_1</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_2</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_3</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_4</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_5</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_6</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_7</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_15</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_30</span>
<span class="k">FROM</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">b</span>
  <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">dates</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">user_remain_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-02%2000.15.41.png" width="87%" /></p>

<p>и®Ўз®—з•™е­зЋ‡пј€и§†е›ѕж–№жі•пј‰пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> 
  <span class="n">dates</span><span class="p">,</span> 
  <span class="n">user_count</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_1</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_1</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_2</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_2</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_3</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_3</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_4</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_4</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_5</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_5</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_6</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_6</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_7</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_7</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_15</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_15</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_30</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_30</span>
<span class="k">FROM</span> <span class="n">user_remain_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-02%2000.50.18.png" width="85%" /></p>

<p>еЏ¦е¤–пјЊж€‘д»¬д№џеЏЇд»ҐйЂљиї‡дЅїз”Ё <code class="language-plaintext highlighter-rouge">WITH AS</code> иЇ­еЏҐе€›е»єдёґж—¶иЎЁи®Ўз®—з•™е­зЋ‡пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="k">WITH</span> <span class="n">temp_table_trades</span> <span class="k">AS</span>
<span class="p">(</span><span class="k">SELECT</span> 
  <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span>	<span class="k">AS</span> <span class="n">user_count</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_1</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_2</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_3</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_4</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_5</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_6</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_7</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_15</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="k">AS</span> <span class="n">remain_30</span>
<span class="k">FROM</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="n">a</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> 
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span> <span class="k">FROM</span> <span class="n">temp_trade</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="n">b</span>
  <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">dates</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">a</span><span class="p">.</span><span class="n">dates</span><span class="p">)</span>
<span class="k">SELECT</span>
  <span class="n">dates</span><span class="p">,</span> 
  <span class="n">user_count</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_1</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_1</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_2</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_2</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_3</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_3</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_4</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_4</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_5</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_5</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_6</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_6</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_7</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_7</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_15</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_15</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="n">remain_30</span> <span class="o">/</span> <span class="n">user_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_30</span>
<span class="k">FROM</span> <span class="n">temp_table_trades</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-01-iShot2021-07-02%2000.50.18.png" width="85%" /></p>

<h4 id="612-rfm-жЁЎећ‹е€†жћђ">6.1.2 RFM жЁЎећ‹е€†жћђ</h4>

<p>RFM жЇ 3 дёЄжЊ‡ж ‡зљ„зј©е†™пјљ</p>

<ul>
  <li><strong>Rпј€Recencyпј‰</strong>иЎЁз¤єжњЂиї‘дёЂж¬Ўж¶€иґ№ж—¶й—ґй—ґйљ”пј›</li>
  <li><strong>Fпј€Frequencyпј‰</strong>иЎЁз¤єж¶€иґ№йў‘зЋ‡пј›</li>
  <li><strong>Mпј€Monetaryпј‰</strong>иЎЁз¤єж¶€иґ№й‡‘йўќгЂ‚</li>
</ul>

<p>йЂљиї‡д»ҐдёЉ 3 дёЄжЊ‡ж ‡еЇ№з”Ёж€·иї›иЎЊе€†з±»зљ„ж–№жі•з§°дёє <strong>RFM жЁЎећ‹е€†жћђ</strong>гЂ‚</p>

<p>дёЌеђЊдёљеЉЎеЇ№еђ„жЊ‡ж ‡зљ„е®љд№‰дёЌеђЊпјЊе…·дЅ“йњЂи¦Ѓж №жЌ®дёљеЉЎењєж™Їе’ЊйњЂж±‚зЃµжґ»е®љд№‰гЂ‚еђ„жЊ‡ж ‡дёЋз”Ёж€·д»·еЂјд№‹й—ґзљ„е…ізі»е¦‚дё‹пјљ</p>

<ul>
  <li>еЇ№дєЋжњЂиї‘дёЂж¬Ўж¶€иґ№ж—¶й—ґй—ґйљ”пј€Rпј‰пјЊдёЉдёЂж¬Ўж¶€иґ№ж—¶й—ґз¦»еѕ—и¶Љиї‘пјЊд№џе°±жЇ R зљ„еЂји¶Ље°ЏпјЊз”Ёж€·д»·еЂји¶Љй«пј›</li>
  <li>еЇ№дєЋж¶€иґ№йў‘зЋ‡пј€Fпј‰пјЊж¶€иґ№йў‘зЋ‡и¶Љй«пјЊд№џе°±жЇ F зљ„еЂји¶Ље¤§пјЊз”Ёж€·д»·еЂји¶Љй«пј›</li>
  <li>еЇ№дєЋж¶€иґ№й‡‘йўќпј€Mпј‰пјЊж¶€иґ№й‡‘йўќи¶Љй«пјЊд№џе°±жЇ M зљ„еЂји¶Ље¤§пјЊз”Ёж€·д»·еЂји¶Љй«гЂ‚</li>
</ul>

<p>е°†иї™ 3 дёЄжЊ‡ж ‡ <strong>жЊ‰з…§д»·еЂј</strong> з”±дЅЋе€°й«жЋ’еєЏпјЊе№¶е°†е…¶дЅњдёєеќђж ‡иЅґпјЊж€‘д»¬еЏЇд»Ґе°†з”Ёж€·з©єй—ґе€†е‰Ідёє 8 дёЄи±Ўй™ђпјЊеЇ№еє”дё‹е›ѕдё­зљ„ 8 з±»з”Ёж€·пјљ</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-02-WX20210702-222315%402x.png" width="60%" /></p>

<p>дєЋжЇпјЊж€‘д»¬еЏЇд»Ґеѕ—е€°д»Ґдё‹з”Ёж€·е€†з±»и§„е€™пјљ</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">з”Ёж€·е€†з±»</th>
      <th style="text-align: center">жњЂиї‘дёЂж¬Ўж¶€иґ№ж—¶й—ґй—ґйљ”пј€Rпј‰</th>
      <th style="text-align: center">ж¶€иґ№йў‘зЋ‡пј€Fпј‰</th>
      <th style="text-align: center">ж¶€иґ№й‡‘йўќпј€Mпј‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1. й‡Ќи¦Ѓд»·еЂјз”Ёж€·</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">й«</td>
    </tr>
    <tr>
      <td style="text-align: left">2. й‡Ќи¦ЃеЏ‘е±•з”Ёж€·</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">й«</td>
    </tr>
    <tr>
      <td style="text-align: left">3. й‡Ќи¦ЃдїќжЊЃз”Ёж€·</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">й«</td>
    </tr>
    <tr>
      <td style="text-align: left">4. й‡Ќи¦ЃжЊЅз•™з”Ёж€·</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">й«</td>
    </tr>
    <tr>
      <td style="text-align: left">5. дёЂи€¬д»·еЂјз”Ёж€·</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">дЅЋ</td>
    </tr>
    <tr>
      <td style="text-align: left">6. дёЂи€¬еЏ‘е±•з”Ёж€·</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">дЅЋ</td>
    </tr>
    <tr>
      <td style="text-align: left">7. дёЂи€¬дїќжЊЃз”Ёж€·</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">й«</td>
      <td style="text-align: center">дЅЋ</td>
    </tr>
    <tr>
      <td style="text-align: left">8. дёЂи€¬жЊЅз•™з”Ёж€·</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">дЅЋ</td>
      <td style="text-align: center">дЅЋ</td>
    </tr>
  </tbody>
</table>

<p><strong>жіЁж„ЏпјљдёЉиЎЁдё­еђ„жЊ‡ж ‡зљ„й«дЅЋд»ЈиЎЁзљ„жЇе…¶еЏЌж е‡єзљ„з”Ёж€·д»·еЂјй«дЅЋпјЊиЂЊйќћжЊ‡ж ‡жњ¬иє«зљ„ж•°еЂје¤§е°ЏгЂ‚</strong></p>

<p>е€©з”Ё RFM жЁЎећ‹пјЊж€‘д»¬еЏЇд»Ґе°†з”Ёж€·жЊ‰з…§д»·еЂјиї›иЎЊе€†з±»пјЊеЇ№дёЌеђЊд»·еЂјзљ„з”Ёж€·й‡‡еЏ–дёЌеђЊзљ„иїђиђҐз­–з•ҐпјЊе°†е…¬еЏёзљ„жњ‰й™ђиµ„жєђеЏ‘жЊҐе‡єжњЂе¤§ж•€з”ЁпјЊд»ЋиЂЊе®ћзЋ° <strong>зІѕз»†еЊ–иїђиђҐ</strong>гЂ‚</p>

<p>е…·дЅ“ж­ҐйЄ¤пјљ</p>

<ol>
  <li>и®Ўз®— RгЂЃFгЂЃM зљ„еЂјгЂ‚дёЂи€¬ж¶‰еЏЉ 3 дёЄж•°жЌ®е­—ж®µпјљз”Ёж€· IDгЂЃж¶€иґ№ж—¶й—ґгЂЃж¶€иґ№й‡‘йўќгЂ‚</li>
  <li>з»™ RгЂЃFгЂЃM еЂјжЊ‰з…§з”Ёж€·д»·еЂјж‰“е€†пј€дѕ‹е¦‚пјЊжњЂиї‘дёЂж¬Ўж¶€иґ№ж—¶й—ґи¶Љиї‘пјЊз”Ёж€·д»·еЂји¶Љй«пјЊR йЎ№е€†еЂје°±и¶Љй«пј‰пјЊдёЂи€¬й‡‡з”Ё 5 е€†е€¶гЂ‚</li>
  <li>и®Ўз®—з”Ёж€·д»·еЂје№іеќ‡еЂјпјЊеЌіе€†е€«и®Ўз®— RгЂЃFгЂЃM еѕ—е€†зљ„е№іеќ‡еЂјгЂ‚</li>
  <li>з”Ёж€·е€†з±»гЂ‚е°†еђ„з”Ёж€·зљ„ RгЂЃFгЂЃM еѕ—е€†е€†е€«дёЋеђ„и‡Єзљ„е№іеќ‡еЂјиї›иЎЊжЇ”иѕѓпјЊз„¶еђЋжЊ‰з…§дёЉйќўзљ„е€†з±»и§„е€™иЎЁеЇ№з”Ёж€·иї›иЎЊе€†з±»гЂ‚</li>
</ol>

<p><strong>1пј‰RFM жЁЎећ‹пјљR йѓЁе€†</strong></p>

<p>R жЊ‡ж ‡е€†жћђпјљж №жЌ®жЇЏдёЄз”Ёж€·жњЂиї‘дёЂж¬Ўиґ­д№°ж—¶й—ґпјЊз»™е‡єз›ёеє”зљ„е€†ж•°гЂ‚</p>

<p>иї™й‡Њж€‘д»¬еЏЇд»Ґе€†дё¤ж­Ґпјљ</p>

<ol>
  <li>иЋ·еЏ–жЇЏдёЄз”Ёж€·зљ„жњЂиї‘иґ­д№°ж—¶й—ґпј›</li>
  <li>и®Ўз®—жЇЏдёЄз”Ёж€·жњЂиї‘иґ­д№°ж—¶й—ґи·ќз¦»еЏ‚з…§ж—Ґжњџз›ёе·®е‡ е¤©пјЊж №жЌ®з›ёе·®зљ„е¤©ж•°иї›иЎЊж‰“е€†гЂ‚</li>
</ol>

<p>жіЁж„ЏпјЊеЏ‚з…§ж—ҐжњџйњЂи¦ЃењЁж‰Ђжњ‰иґ­д№°ж—Ґжњџд№‹еђЋпјЊиї™й‡Њж€‘д»¬еЏЇд»ҐйЂ‰еЏ– <code class="language-plaintext highlighter-rouge">2019-12-18</code> дЅњдёєеЏ‚з…§ж—ҐжњџгЂ‚</p>

<p>еЏ¦е¤–пјЊж€‘д»¬иї™й‡Њй‡‡з”Ё 5 е€†е€¶пјЊйЂљиї‡и®Ўз®—жњЂиї‘дёЂж¬Ўиґ­д№°ж—Ґжњџи·ќз¦»еЏ‚з…§ж—Ґжњџзљ„е¤©ж•°пјЊе¦‚жћњпјљ</p>

<ul>
  <li>&lt;= 2пјЊж‰“ 5 е€†пј›</li>
  <li>&lt;= 4пјЊж‰“ 4 е€†пј›</li>
  <li>&lt;= 6пјЊж‰“ 3 е€†пј›</li>
  <li>&lt;= 8пјЊж‰“ 2 е€†пј›</li>
  <li>е…¶д»–пјЊж‰“ 1 е€†гЂ‚</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="c1">-- R жЊ‡ж ‡е€†жћђпјљж №жЌ®жЇЏдёЄз”Ёж€·жњЂиї‘дёЂж¬Ўиґ­д№°ж—¶й—ґпјЊз»™е‡єз›ёеє”зљ„е€†ж•°</span>

<span class="c1">-- 1. е»єз«‹ R и§†е›ѕпјљз»џи®ЎжЇЏдёЄз”Ёж€·зљ„жњЂиї‘иґ­д№°ж—¶й—ґ</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">user_recency_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">user_recency_view</span> <span class="k">AS</span>
<span class="k">SELECT</span>
  <span class="n">user_id</span><span class="p">,</span> 
  <span class="k">MAX</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="k">AS</span> <span class="n">recent_buy_time</span>
<span class="k">FROM</span>  <span class="n">temp_trade</span>
<span class="k">WHERE</span> <span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">;</span>

<span class="c1">-- 2. е»єз«‹ R иЇ„е€†и§†е›ѕпјљи®Ўз®—жЇЏдёЄз”Ёж€·жњЂиї‘иґ­д№°ж—¶й—ґи·ќз¦»еЏ‚з…§ж—Ґжњџ '2019-12-18' зљ„е¤©ж•°пјЊ</span>
<span class="c1">-- ж №жЌ®и·ќз¦»е¤©ж•°иї›иЎЊж‰“е€†пјљ&lt;=2 5е€†пј›&lt;=4 4е€†пј›&lt;=6 3е€†пј›&lt;=8 2е€†пј›е…¶д»– 1е€†</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">r_score_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">r_score_view</span> <span class="k">AS</span>
<span class="k">SELECT</span> 
  <span class="n">user_id</span><span class="p">,</span>
  <span class="n">recent_buy_time</span><span class="p">,</span>
  <span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'2019-12-18'</span><span class="p">,</span> <span class="n">recent_buy_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">date_distance</span><span class="p">,</span>
  <span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'2019-12-18'</span><span class="p">,</span> <span class="n">recent_buy_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="mi">5</span>
    <span class="k">WHEN</span> <span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'2019-12-18'</span><span class="p">,</span> <span class="n">recent_buy_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">THEN</span> <span class="mi">4</span>
    <span class="k">WHEN</span> <span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'2019-12-18'</span><span class="p">,</span> <span class="n">recent_buy_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="k">THEN</span> <span class="mi">3</span>
    <span class="k">WHEN</span> <span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'2019-12-18'</span><span class="p">,</span> <span class="n">recent_buy_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="k">THEN</span> <span class="mi">2</span>
    <span class="k">ELSE</span> <span class="mi">1</span> 
  <span class="k">END</span> <span class="k">AS</span> <span class="n">r_score</span>
<span class="k">FROM</span> <span class="n">user_recency_view</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">r_score_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-02-WX20210703-000033%402x.png" width="45%" /></p>

<p><strong>2пј‰RFM жЁЎећ‹пјљF йѓЁе€†</strong></p>

<p>F жЊ‡ж ‡е€†жћђпјљи®Ўз®—жЇЏдёЄз”Ёж€·ењЁдёЂе®љж—¶й—ґе†…зљ„ж¶€иґ№йў‘зЋ‡пјЊз»™е‡єз›ёеє”е€†ж•°гЂ‚</p>

<p>иї™й‡ЊпјЊж€‘д»¬д»Ґж•ґдёЄж•°жЌ®й›†дё­зљ„ж—¶й—ґи·Ёеє¦дёєе‡†пјЊеЌідёЌй™ђе€¶е…·дЅ“ж—¶й—ґж®µпјЊз»џи®ЎжЇЏдёЄз”Ёж€·ењЁж•°жЌ®й›†дё­зљ„ж‰Ђжњ‰ж¶€иґ№ж¬Ўж•°гЂ‚</p>

<p>еђЊж ·пјЊж€‘д»¬иї™й‡Њй‡‡з”Ё 5 е€†е€¶пјЊйЂљиї‡еЇ№з”Ёж€·е€†з»„пјЊи®Ўз®—жЇЏдёЄз”Ёж€·жњ‰е¤ље°‘жќЎж¶€иґ№и®°еЅ•пјЊе¦‚жћњпјљ</p>

<ul>
  <li>&lt;= 2пјЊж‰“ 1 е€†пј›</li>
  <li>&lt;= 4пјЊж‰“ 2 е€†пј›</li>
  <li>&lt;= 6пјЊж‰“ 3 е€†пј›</li>
  <li>&lt;= 8пјЊж‰“ 4 е€†пј›</li>
  <li>е…¶д»–пјЊж‰“ 5 е€†гЂ‚</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="c1">-- F жЊ‡ж ‡и®Ўз®—пјљз»џи®ЎжЇЏдёЄз”Ёж€·зљ„ж¶€иґ№ж¬Ўж•°пјЊз»™е‡єз›ёеє”зљ„е€†ж•°</span>

<span class="c1">-- 1. е»єз«‹ F и§†е›ѕпјљз»џи®ЎжЇЏдёЄз”Ёж€·зљ„ж¶€иґ№ж¬Ўж•°</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">user_frequency_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">user_frequency_view</span> <span class="k">AS</span>
<span class="k">SELECT</span>
  <span class="n">user_id</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">buy_frequency</span>
<span class="k">FROM</span> <span class="n">temp_trade</span>
<span class="k">WHERE</span> <span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">;</span>

<span class="c1">-- 2. е»єз«‹ F иЇ„е€†и§†е›ѕпјљеџєдєЋиґ­д№°ж¬Ўж•°еЇ№з”Ёж€·иї›иЎЊж‰“е€†</span>
<span class="c1">-- жЊ‰з…§иґ­д№°ж¬Ўж•°иЇ„е€†пјљ&lt;=2 1е€†пј›&lt;=4 2е€†пј›&lt;=6 3е€†пј›&lt;=8 4е€†пј›е…¶д»– 5е€†</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">f_score_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">f_score_view</span> <span class="k">AS</span>
<span class="k">SELECT</span>
  <span class="n">user_id</span><span class="p">,</span>
  <span class="n">buy_frequency</span><span class="p">,</span>
  <span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="n">buy_frequency</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="mi">1</span>
    <span class="k">WHEN</span> <span class="n">buy_frequency</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">THEN</span> <span class="mi">2</span>
    <span class="k">WHEN</span> <span class="n">buy_frequency</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="k">THEN</span> <span class="mi">3</span>
    <span class="k">WHEN</span> <span class="n">buy_frequency</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="k">THEN</span> <span class="mi">4</span>
    <span class="k">ELSE</span> <span class="mi">5</span>
  <span class="k">END</span> <span class="k">AS</span> <span class="n">f_score</span>
<span class="k">FROM</span> <span class="n">user_frequency_view</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">f_score_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-02-WX20210703-000633%402x.png" width="32%" /></p>

<p><strong>3пј‰ж•ґеђ€з»“жћњ</strong></p>

<p>з”±дєЋиЇҐж•°жЌ®й›†дё­жІЎжњ‰еЊ…еђ«ж¶€иґ№й‡‘йўќз›ёе…ізљ„е­—ж®µдїЎжЃЇпјЊиї™й‡Њж€‘д»¬е°†д»…еџєдєЋжњЂиї‘дёЂж¬Ўж¶€иґ№ж—¶й—ґй—ґйљ”пј€Rпј‰е’Њж¶€иґ№йў‘зЋ‡пј€Fпј‰е»євЅґ RFM жЁЎећ‹пјЊе№¶дё”е°†з”Ёж€·е€†дёєд»Ґдё‹ 4 з±»пјљ</p>

<ul>
  <li>й‡Ќи¦Ѓвѕјд»·еЂје®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиї‘вЅЅдё”ж¶€иґ№йў‘зЋ‡иѕѓвѕјзљ„е®ўж€·пј›</li>
  <li>й‡Ќи¦Ѓе”¤е›ће®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиїњдё”ж¶€иґ№йў‘зЋ‡иѕѓвѕјзљ„е®ўж€·пј›</li>
  <li>й‡Ќи¦Ѓж·±иЂ•е®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиї‘дё”ж¶€иґ№йў‘зЋ‡иѕѓдЅЋзљ„е®ўж€·пј›</li>
  <li>й‡Ќи¦ЃжЊЅз•™е®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиїњдё”ж¶€иґ№йў‘зЋ‡иѕѓдЅЋзљ„е®ўж€·гЂ‚</li>
</ul>

<p>ж€‘д»¬е°†жЊ‰з…§жњЂиї‘вјЂж¬Ўж¶€иґ№ж—¶й—ґй—ґйљ”зљ„еќ‡еЂје’Њж¶€иґ№йў‘зЋ‡зљ„еќ‡еЂјжќҐзЎ®е®љ R е’Њ F еѕ—е€†зљ„вѕјгЂЃдЅЋе€†з•ЊзєїгЂ‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1">-- и®Ўз®— R еѕ—е€†е’Њ F еѕ—е€†зљ„еќ‡еЂј</span>
<span class="k">SELECT</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">r_score</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">r_score_view</span><span class="p">)</span> <span class="k">AS</span> <span class="n">r_avg</span><span class="p">,</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">f_score</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">f_score_view</span><span class="p">)</span> <span class="k">AS</span> <span class="n">f_avg</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-02-WX20210703-010249%402x.png" width="16%" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">-- ж‹їе€°жЇЏдёЄз”Ёж€·зљ„ R еѕ—е€†е’Њ F еѕ—е€†пј€дё¤иЎЁе…іиЃ” r_score_view е’Њ f_score_viewпј‰пјЊз„¶еђЋдёЋеќ‡еЂјеЇ№жЇ”пјЊеѕ—е€°еђ„з”Ёж€·з±»ећ‹</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">rfm_inall_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">rfm_inall_view</span> <span class="k">AS</span>
<span class="k">SELECT</span>
  <span class="n">r</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
  <span class="n">r</span><span class="p">.</span><span class="n">r_score</span><span class="p">,</span>
  <span class="n">f</span><span class="p">.</span><span class="n">f_score</span><span class="p">,</span>
  <span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="n">r</span><span class="p">.</span><span class="n">r_score</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">7939</span> <span class="k">AND</span> <span class="n">f</span><span class="p">.</span><span class="n">f_score</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2606</span> <span class="k">THEN</span> <span class="s1">'й‡Ќи¦Ѓй«д»·еЂје®ўж€·'</span>
    <span class="k">WHEN</span> <span class="n">r</span><span class="p">.</span><span class="n">r_score</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">7939</span> <span class="k">AND</span> <span class="n">f</span><span class="p">.</span><span class="n">f_score</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2606</span> <span class="k">THEN</span> <span class="s1">'й‡Ќи¦Ѓе”¤е›ће®ўж€·'</span>
    <span class="k">WHEN</span> <span class="n">r</span><span class="p">.</span><span class="n">r_score</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">7939</span> <span class="k">AND</span> <span class="n">f</span><span class="p">.</span><span class="n">f_score</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2606</span> <span class="k">THEN</span> <span class="s1">'й‡Ќи¦Ѓж·±иЂ•е®ўж€·'</span>
    <span class="k">WHEN</span> <span class="n">r</span><span class="p">.</span><span class="n">r_score</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">7939</span> <span class="k">AND</span> <span class="n">f</span><span class="p">.</span><span class="n">f_score</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2606</span> <span class="k">THEN</span> <span class="s1">'й‡Ќи¦ЃжЊЅз•™е®ўж€·'</span>
  <span class="k">END</span> <span class="k">AS</span> <span class="n">user_class</span>
<span class="k">FROM</span> <span class="n">r_score_view</span> <span class="k">AS</span> <span class="n">r</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">f_score_view</span> <span class="k">AS</span> <span class="n">f</span> <span class="k">ON</span> <span class="n">r</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">rfm_inall_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-223152%402x.png" width="38%" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">-- з»џи®Ўеђ„з”Ёж€·зљ„з”Ёж€·з±»ећ‹гЂЃжњЂиї‘дёЂж¬Ўиґ­д№°ж—¶й—ґй—ґйљ”гЂЃиґ­д№°йў‘зЋ‡</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">user_class_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">user_class_view</span> <span class="k">AS</span> 
<span class="k">WITH</span> <span class="n">temp_rf</span> <span class="k">AS</span> <span class="p">(</span>
<span class="k">SELECT</span>
  <span class="n">r</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> 
  <span class="n">date_distance</span><span class="p">,</span> 
  <span class="n">buy_frequency</span>
<span class="k">FROM</span> <span class="n">r_score_view</span> <span class="n">r</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">f_score_view</span> <span class="n">f</span> <span class="k">ON</span> <span class="n">r</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> 
<span class="k">SELECT</span> 
  <span class="n">rfm</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
  <span class="n">user_class</span><span class="p">,</span> 
  <span class="n">date_distance</span><span class="p">,</span> 
  <span class="n">buy_frequency</span>
<span class="k">FROM</span> <span class="n">rfm_inall_view</span> <span class="k">AS</span> <span class="n">rfm</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">temp_rf</span> <span class="k">AS</span> <span class="n">trf</span> <span class="k">ON</span> <span class="n">rfm</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">trf</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">user_class_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-230515%402x.png" width="50%" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">-- з»џи®Ўеђ„дёЄз”Ёж€·з±»ећ‹дё‹зљ„з”Ёж€·ж•°й‡ЏгЂЃжњЂиї‘дёЂж¬Ўиґ­д№°зљ„е№іеќ‡ж—¶й—ґй—ґйљ”гЂЃе№іеќ‡ж¶€иґ№йў‘зЋ‡</span>
<span class="k">SELECT</span>
  <span class="n">user_class</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">user_count</span><span class="p">,</span>
  <span class="k">AVG</span><span class="p">(</span><span class="n">date_distance</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_date_distance</span><span class="p">,</span>
  <span class="k">AVG</span><span class="p">(</span><span class="n">buy_frequency</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_buy_frequency</span>
<span class="k">FROM</span> <span class="n">user_class_view</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_class</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-232624%402x.png" width="60%" /></p>

<p>зЋ°ењЁпјЊж€‘д»¬е·Із»Џе®Њж€ђдє†еЇ№з”Ёж€·зѕ¤дЅ“зљ„е€†з±»пјЊиї™е®ћй™…дёЉз›ёеЅ“дєЋењЁдёЂе®љзЁ‹еє¦дёЉеЇ№з”Ёж€·иї›иЎЊз”»еѓЏпјЊжЋҐдё‹жќҐе°±еЏЇд»Ґй’€еЇ№дёЌеђЊз”Ёж€·зѕ¤дЅ“й‡‡еЏ–дёЌеђЊзљ„иїђиђҐз­–з•ҐгЂ‚еЅ“з„¶пјЊеђЋз»­е…·дЅ“иїђиђҐз­–з•Ґзљ„и®ѕи®Ўе’Ње®ћж–Ѕе°±е±ћдєЋиїђиђҐдєєе‘зљ„е·ҐдЅњиЊѓе›ґдє†гЂ‚</p>

<h3 id="62-е•†е“ЃжЊ‡ж ‡дЅ“зі»">6.2 е•†е“ЃжЊ‡ж ‡дЅ“зі»</h3>

<p>е‰Ќйќўж€‘д»¬е€†жћђдє† вЂњдєєиґ§ењєвЂќ дё­дёЋ вЂњдєєпј€з”Ёж€·пј‰вЂќ з›ёе…ізљ„жЊ‡ж ‡пјЊзЋ°ењЁж€‘д»¬жќҐе€†жћђдёЋ вЂњиґ§пј€е•†е“Ѓпј‰вЂќ з›ёе…ізљ„жЊ‡ж ‡гЂ‚</p>

<p>ж€‘д»¬е°†д»Ћдё‹йќўдё¤дёЄз»ґеє¦жќҐиї›иЎЊе€†жћђпјљ</p>

<ul>
  <li><strong>жЊ‰з…§е•†е“Ѓиї›иЎЊе€†з»„з»џи®Ўпјљ</strong>е•†е“Ѓзљ„з‚№е‡»й‡Џпј€жµЏи§€ / ж›ќе…‰пј‰гЂЃж”¶и—Џй‡ЏгЂЃеЉ иґ­й‡Џпј€еЉ е…Ґиґ­з‰©иЅ¦зљ„ж¬Ўж•°пј‰гЂЃиґ­д№°ж¬Ўж•°гЂЃиґ­д№°иЅ¬еЊ–зЋ‡пј€иЇҐе•†е“Ѓзљ„ж‰Ђжњ‰вЅ¤ж€·дё­жњ‰иґ­д№°иЅ¬еЊ–зљ„вЅ¤ж€·еЌ вЅђпј‰гЂ‚</li>
  <li><strong>жЊ‰з…§е•†е“Ѓе“Ѓз±»иї›иЎЊе€†з»„з»џи®Ўпјљ</strong>еЇ№еє”е“Ѓз±»зљ„з‚№е‡»й‡ЏгЂЃж”¶и—Џй‡ЏгЂЃеЉ иґ­й‡ЏгЂЃиґ­д№°ж¬Ўж•°гЂЃиґ­д№°иЅ¬еЊ–зЋ‡гЂ‚</li>
</ul>

<h4 id="621-е•†е“ЃжЊ‡ж ‡з»џи®Ў">6.2.1 е•†е“ЃжЊ‡ж ‡з»џи®Ў</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">-- з»џи®Ўеђ„е•†е“Ѓзљ„з‚№е‡»й‡ЏгЂЃж”¶и—Џй‡ЏгЂЃеЉ иґ­й‡ЏгЂЃиґ­д№°ж¬Ўж•°гЂЃиґ­д№°иЅ¬еЊ–зЋ‡</span>
<span class="k">SELECT</span>
  <span class="n">item_id</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">pv</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">favorite</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">cart</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">purchase</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="o">/</span> 
               <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">purchase_ratio</span>
<span class="k">FROM</span> <span class="n">temp_trade</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">item_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">purchase</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">purchase_ratio</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-133926%402x.png" width="55%" /></p>

<p>жіЁж„Џпјљз”±дєЋиї™й‡Њж€‘д»¬зљ„ж•°жЌ®й›†жЇ”иѕѓжњ‰й™ђпјЊи®Ўз®—еѕ—е€°зљ„иЅ¬еЊ–зЋ‡зљ„еЂјзљ„й›†еђ€еЏЇиѓЅжЇ”иѕѓе°ЏгЂ‚</p>

<h4 id="622-е•†е“Ѓе“Ѓз±»жЊ‡ж ‡з»џи®Ў">6.2.2 е•†е“Ѓе“Ѓз±»жЊ‡ж ‡з»џи®Ў</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">-- з»џи®Ўеђ„е“Ѓз±»зљ„з‚№е‡»й‡ЏгЂЃж”¶и—Џй‡ЏгЂЃеЉ иґ­й‡ЏгЂЃиґ­д№°ж¬Ўж•°гЂЃиґ­д№°иЅ¬еЊ–зЋ‡</span>
<span class="k">SELECT</span>
  <span class="n">item_category</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">pv</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">favorite</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">cart</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">purchase</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="o">/</span> 
               <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">purchase_ratio</span>
<span class="k">FROM</span> <span class="n">temp_trade</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">item_category</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">purchase</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">purchase_ratio</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-134048%402x.png" width="58%" /></p>

<h3 id="63-е№іеЏ°жЊ‡ж ‡дЅ“зі»">6.3 е№іеЏ°жЊ‡ж ‡дЅ“зі»</h3>

<p>е‰Ќйќўж€‘д»¬е€†жћђдє† вЂњдєєиґ§ењєвЂќ дё­зљ„ вЂњдєєпј€з”Ёж€·пј‰вЂќ е’Њ вЂњиґ§пј€е•†е“Ѓпј‰вЂќ зљ„з›ёе…іжЊ‡ж ‡пјЊжЋҐдё‹жќҐж€‘д»¬жќҐе€†жћђдёЋ вЂњењєпј€е№іеЏ°пј‰вЂќ з›ёе…ізљ„жЊ‡ж ‡гЂ‚</p>

<p>еђЊж ·пјЊж€‘д»¬д»Ћд»Ґдё‹дё¤дёЄз»ґеє¦иї›иЎЊе€†жћђпјљ</p>

<ul>
  <li>
    <p><strong>д»Ће№іеЏ°и§’еє¦жќҐзњ‹з”Ёж€·зљ„иЎЊдёєпјљ</strong>жЊ‰ж—Ґз»џи®Ўж•ґдёЄе№іеЏ°зљ„з‚№е‡»й‡ЏгЂЃж”¶и—Џй‡ЏгЂЃеЉ иґ­й‡ЏгЂЃиґ­д№°ж¬Ўж•°гЂЃиґ­д№°иЅ¬еЊ–зЋ‡гЂ‚</p>
  </li>
  <li>
    <p><strong>з”Ёж€·иЎЊдёєи·Їеѕ„е€†жћђпјљ</strong>з”Ёж€·ењЁиґ­д№°е•†е“Ѓзљ„ж—¶еЂ™пјЊеЏЇиѓЅдјљз»ЏеЋ†дёЂзі»е€—зљ„ж“ЌдЅњпјЊдѕ‹е¦‚пјљвЂњжµЏи§€ $\rightarrow$ ж”¶и—Џ $\rightarrow$ еЉ е…Ґиґ­з‰©иЅ¦ $\rightarrow$ ж”Їд»иґ­д№°вЂќпј›ж€–иЂ… вЂњжµЏи§€ $\rightarrow$ ж”Їд»иґ­д№°вЂќпјЊеЏ€ж€–иЂ… вЂњжµЏи§€ $\rightarrow$ еЉ е…Ґиґ­з‰©иЅ¦ $\rightarrow$ ж”Їд»иґ­д№°вЂќ з­‰з­‰пјЊж€‘д»¬е°†иї™дє›з»џз§°дёєиЎЊдёєи·Їеѕ„гЂ‚иї™й‡ЊпјЊж€‘д»¬еЏЇд»Ґд»ҐжњЂиї‘дёЂж¬Ўзљ„ вЂњж”Їд»иґ­д№°вЂќ иЎЊдёєдёєеџєе‡†пјЊе№¶еѕЂе‰ЌжЋЁ 4 дёЄж“ЌдЅњиЎЊдёєпјЊз”±ж­¤еѕ—е€°дёЂжќЎз”± 5 дёЄж“ЌдЅњз»„ж€ђзљ„иЎЊдёєи·Їеѕ„пјЊз„¶еђЋз»џи®ЎжЇЏжќЎиЎЊдёєи·Їеѕ„дё‹зљ„з”Ёж€·ж•°й‡ЏгЂ‚</p>
  </li>
</ul>

<h4 id="631-е№іеЏ°з”Ёж€·жЊ‡ж ‡з»џи®Ў">6.3.1 е№іеЏ°з”Ёж€·жЊ‡ж ‡з»џи®Ў</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">-- з»џи®Ўе№іеЏ°жЇЏж—Ґзљ„з‚№е‡»й‡ЏгЂЃж”¶и—Џй‡ЏгЂЃеЉ иґ­й‡ЏгЂЃиґ­д№°ж¬Ўж•°гЂЃиґ­д№°иЅ¬еЊ–зЋ‡</span>
<span class="k">SELECT</span>
  <span class="n">dates</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">pv</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">favorite</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">cart</span><span class="p">,</span>
  <span class="k">SUM</span><span class="p">(</span><span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">AS</span> <span class="n">purchase</span><span class="p">,</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">ROUND</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">IF</span><span class="p">(</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">NULL</span><span class="p">))</span> <span class="o">/</span> 
               <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'%'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">purchase_ratio</span>
<span class="k">FROM</span> <span class="n">temp_trade</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dates</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dates</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-165511%402x.png" width="55%" /></p>

<h4 id="632-з”Ёж€·иЎЊдёєи·Їеѕ„е€†жћђ">6.3.2 з”Ёж€·иЎЊдёєи·Їеѕ„е€†жћђ</h4>

<p>е¦‚е‰Ќж‰Ђиї°пјЊиї™й‡Њж€‘д»¬д»ҐжњЂеђЋзљ„ вЂњж”Їд»иґ­д№°вЂќ дёєеџєе‡†пјЊе№¶еѕЂе‰ЌжЋЁ 4 дёЄж“ЌдЅњиЎЊдёєпјЊз”±ж­¤еѕ—е€°дёЂжќЎз”± 5 дёЄж“ЌдЅњз»„ж€ђзљ„иЎЊдёєи·Їеѕ„пјЊз„¶еђЋз»џи®ЎжЇЏжќЎиЎЊдёєи·Їеѕ„дё‹зљ„з”Ёж€·ж•°й‡ЏгЂ‚</p>

<p>иї™й‡Њеђ„иЎЊдёєд»ЈеЏ·еЏЇд»Ґд»Ћз”Ёж€·иЎЊдёєе­—ж®µ <code class="language-plaintext highlighter-rouge">behavior_type</code> иЋ·еЏ–пјљ</p>

<ul>
  <li>1пјљж›ќе…‰</li>
  <li>2пјљиґ­д№°</li>
  <li>3пјљеЉ вјЉиґ­з‰©в»‹</li>
  <li>4пјљеЉ вјЉж”¶и—Џе¤№</li>
</ul>

<p>иї™й‡Њзљ„ж ёеїѓж­ҐйЄ¤жЇпјљж‹јжЋҐиЎЊдёєи·Їеѕ„гЂ‚</p>

<p>дѕ‹е¦‚пјЊеЇ№дєЋз”Ёж€·еј дё‰пјЊе…¶еЇ№дєЋ a е•†е“ЃеЏЇиѓЅе­ењЁд»Ґдё‹иЎЊдёєпјљ1гЂЃ3гЂЃ2гЂЃ4гЂЃ3гЂЃ1гЂЃ2гЂ‚ж€‘д»¬д»ЋжњЂеђЋзљ„ 2пј€иґ­д№°пј‰ејЂе§‹пјЊеѕЂе‰ЌжЋЁ 4 дёЄиЎЊдёєпјЊз„¶еђЋж‹јжЋҐеѕ—е€°дёЂжќЎ вЂњ2 $\rightarrow$ 4 $\rightarrow$ 3 $\rightarrow$ 1 $\rightarrow$ 2вЂќ зљ„иЎЊдёєи·Їеѕ„гЂ‚</p>

<p>е› ж­¤пјЊж€‘д»¬йњЂи¦Ѓпјљ</p>

<ol>
  <li>е°†е¤љдёЄиЎЊдёєе№¶е€—ж‘†ж”ѕпјЊеЌідЅїз”ЁзЄ—еЏЈе‡Ѕж•°дё­зљ„еЃЏз§»е€†жћђе‡Ѕж•° <code class="language-plaintext highlighter-rouge">LAG()</code> ж€–иЂ… <code class="language-plaintext highlighter-rouge">LEAD()</code> дёєеђ„иЎЊдёєе€†е€«е€›е»єдёЂдёЄе­—ж®µпј›</li>
  <li>дЅїз”Ё <code class="language-plaintext highlighter-rouge">CONCAT()</code> е‡Ѕж•°еЇ№еђ„иЎЊдёєе­—ж®µиї›иЎЊж‹јжЋҐпјЊеѕ—е€°иЎЊдёєи·Їеѕ„пј›</li>
  <li>з»џи®Ўеђ„иЎЊдёєи·Їеѕ„дё‹зљ„з”Ёж€·ж•°й‡ЏгЂ‚</li>
</ol>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="cm">/*
з”Ёж€·иЎЊдёєж‹јжЋҐе‡†е¤‡

дЅїз”ЁеЃЏз§»е€†жћђе‡Ѕж•° LAG() ж€–иЂ… LEAD() дёєеђ„иЎЊдёєе€†е€«е€›е»єдёЂдёЄе­—ж®µпјЊиї™й‡Њж¶‰еЏЉе€°е€†з»„е’ЊжЋ’еєЏпјљ
1. е°† PARTITION BY еђЋзљ„е­—ж®µжЊ‡е®љдёє user_id е’Њ item_id
2. е°† ORDER BY еђЋзљ„е­—ж®µжЊ‡е®љдёє date_time

жіЁж„ЏпјЊиї™й‡Њж€‘д»¬жЋ’еєЏе­—ж®µжЊ‡е®љзљ„жЇ date_time иЂЊдёЌжЇ datesпјЊе› дёєеђЊдёЂе¤©е†…еЏЇиѓЅе­ењЁе¤љдёЄиЎЊдёєпјЊйњЂи¦ЃиЂѓи™‘е®ѓд»¬д№‹й—ґзљ„йЎєеєЏгЂ‚
еЏ¦е¤–пјЊз”±дєЋи¦Ѓз»џи®Ўзљ„жЇжњЂиї‘дёЂж¬Ўиґ­д№°иЎЊдёєеЇ№еє”зљ„и·Їеѕ„пјЊеЏЇд»ҐдЅїз”ЁжЋ’еєЏе‡Ѕж•° RANK() жЊ‰з…§ date_time е­—ж®µиї›иЎЊеЂ’жЋ’еєЏпјЊз„¶еђЋеЏ–з¬¬дёЂжќЎи®°еЅ•гЂ‚
*/</span>
<span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">path_base_view</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">path_base_view</span> <span class="k">AS</span>
<span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> 
  <span class="p">(</span><span class="k">SELECT</span>
    <span class="n">user_id</span><span class="p">,</span>
    <span class="n">item_id</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">behavior_type</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lag_4</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">behavior_type</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lag_3</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">behavior_type</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lag_2</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">behavior_type</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lag_1</span><span class="p">,</span>
    <span class="n">behavior_type</span><span class="p">,</span>
    <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">date_time</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rank_number</span>
  <span class="k">FROM</span> <span class="n">temp_trade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span>
<span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">rank_number</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">behavior_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">path_base_view</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-174817%402x.png" width="70%" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">-- ж‹јжЋҐиЎЊдёєи·Їеѕ„пјЊе№¶з»џи®Ўеђ„иЎЊдёєи·Їеѕ„дё‹зљ„з”Ёж€·ж•°й‡Џ </span>
<span class="c1">-- жіЁж„Џпјљlag_4 е€° lag_1 еЏЇиѓЅе­ењЁ NULLпјЊе› ж­¤ж€‘д»¬з”Ёе­—з¬¦дёІ 'з©є' жќҐеЇ№е…¶иї›иЎЊж ‡и®°пјЊйІж­ў CONCAT е‡Ѕж•°иѕ“е‡є NULL еЂјгЂ‚ </span>
<span class="k">SELECT</span> 
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_4</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_3</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_2</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_1</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">behavior_type</span><span class="p">)</span> <span class="k">AS</span> <span class="n">behavior_path</span><span class="p">,</span>
  <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">user_count</span>
<span class="k">FROM</span> <span class="n">path_base_view</span>
<span class="k">GROUP</span> <span class="k">BY</span>
  <span class="n">CONCAT</span><span class="p">(</span><span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_4</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_3</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_2</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span>
         <span class="n">IFNULL</span><span class="p">(</span><span class="n">lag_1</span><span class="p">,</span> <span class="s1">'з©є'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">,</span> 
         <span class="n">behavior_type</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">user_count</span> <span class="k">DESC</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210704-001255%402x.png" width="25%" /></p>

<h2 id="7-з»“и®є">7. з»“и®є</h2>

<p>и‡іж­¤пјЊж€‘д»¬е·Із»Џе€†жћђе®Њдє† вЂњдєєвЂќгЂЃвЂњиґ§вЂќгЂЃвЂњењєвЂќ дё‰дёЄз»ґеє¦дё‹зљ„и‹Ґе№ІжЊ‡ж ‡гЂ‚жЋҐдё‹жќҐж€‘д»¬е°†еЇ№з›ёе…із»“и®єиї›иЎЊжўізђ†гЂ‚</p>

<h3 id="71-з”Ёж€·е€†жћђ">7.1 з”Ёж€·е€†жћђ</h3>

<p>з”Ёж€·е€†жћђдё­пјЊж€‘д»¬жњ‰дёЂдёЄйќћеёёй‡Ќи¦Ѓзљ„жЊ‡ж ‡пјЊе°±жЇ UVпј€з‹¬з«‹и®їе®ўж•°пј‰гЂ‚ж€‘д»¬жЇЏе¤©дјљеЇ№ UV иї›иЎЊз»џи®ЎпјЊйЂљиї‡еЇ№ UV иї›иЎЊеј‚еёёе€†жћђпјЊеЏЇд»ҐеЏ‘зЋ°дёЂдє›й—®йўгЂ‚дѕ‹е¦‚пјЊж€‘д»¬д№‹е‰ЌжЊ‰ж—ҐжњџеЇ№ UV иї›иЎЊиї‡ж•°й‡Џз»џи®ЎпјЊж€‘д»¬еЏЇд»ҐйЂљиї‡дё‹йќўзљ„жЉзєїе›ѕжќҐи§‚еЇџе…¶еЏеЊ–и¶‹еЉїпјљ</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-%E5%9B%BE%E7%89%87%201.png" width="60%" /></p>

<center><font size="2"><b>е›ѕ 1. </b>UV еј‚еёёе€†жћђпјљжЇЏвЅ‡ UV ж•°жЌ®дё­пјЊжЋжѕеј‚еёёз‚№дёєеЏЊвј—вј†жґ»еЉЁйЂ ж€ђпјЊиЇҐеЅ±е“Ќдёєе·ІзџҐеЅ±е“ЌгЂ‚</font></center>

<p>еЏЇд»Ґзњ‹е€°пјЊжЇЏж—Ґзљ„ UV ж•°жЌ®е›ѕдё­пјЊе­ењЁдёЂдёЄйќћеёёжЋжѕзљ„жіўеі°пјЊе®ѓеЇ№еє”дєЋдёЂдёЄз‰№ж®Љзљ„ж—Ґжњџ <code class="language-plaintext highlighter-rouge">2019-12-12</code>пјЊеЌі вЂњеЏЊеЌЃдєЊвЂќгЂ‚йЂљеёёпјЊж•°жЌ®дё­зљ„иї™з§Ќжіўеі°е±ћдєЋдёЂдёЄеј‚еёёз‚№пјЊдЅ†жЇиї™й‡Њзљ„иї™дёЄеј‚еёёз‚№жЇз”±дёЂдёЄе·ІзџҐе› зґ йЂ ж€ђзљ„пјЊе› дёє вЂњеЏЊеЌЃдєЊвЂќ е±ћдєЋиґ­з‰©иЉ‚пјЊеЅ“е¤©и®їй—®й‡ЏеўћеЉ е±ћдєЋж­Јеёёжѓ…е†µгЂ‚еЏЇи§ЃпјЊйЂљиї‡е€†жћђ UV ж›ІзєїпјЊж€‘д»¬зЎ®е®ћеЏЇд»Ґи§‚еЇџе€°дёЂдє›зЋ°и±ЎгЂ‚</p>

<p>еђЊж—¶пјЊж€‘д»¬иїеЏЇд»ҐеЇ№ UV ж•°жЌ®зљ„е‘ЁзЋЇжЇ”иї›иЎЊе€†жћђгЂ‚дѕ‹е¦‚пјЊеЃ‡и®ѕд»Ље¤©жЇе‘Ёдё‰пјЊж€‘д»¬еЏЇд»Ґж‹їд»Ље¤©зљ„ UV ж•°жЌ®е’ЊдёЉе‘Ёдё‰зљ„ UV ж•°жЌ®иї›иЎЊеЇ№жЇ”пјЊе…·дЅ“и®Ўз®—ж–№ејЏдёєпјљпј€жњ¬е‘Ёдё‰ UV пјЌ дёЉе‘Ёдё‰ UVпј‰/ дёЉе‘Ёдё‰ UVгЂ‚дёєд»Ђд№€ж€‘д»¬и¦ЃжЇ”иѕѓе‘ЁзЋЇжЇ”пј€е’ЊдёЂе‘Ёе‰Ќзљ„ж•°жЌ®з›ёжЇ”пј‰пјЊиЂЊдёЌжЇе’Ње‰ЌдёЂе¤©зљ„ж•°жЌ®з›ёжЇ”е‘ўпјџе› дёєе‰ЌдёЂе¤©зљ„ж•°жЌ®ж—¶й—ґй—ґйљ”е¤Єзџ­пјЊжЇ”иѕѓиµ·жќҐж„Џд№‰дёЌе¤§гЂ‚еђЊж ·пјЊж€‘д»¬еЏЇд»Ґз»е€¶ UV зљ„е‘ЁзЋЇжЇ”жЉзєїе›ѕи§‚еЇџе…¶еЏеЊ–и¶‹еЉїпјљ</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-%E5%9B%BE%E7%89%87%201-1.png" width="60%" /></p>

<font size="2"><b>е›ѕ 2.В </b>UV е‘ЁзЋЇвЅђе€†жћђпјљвЅ‡еёёе‘ЁзЋЇвЅђж•°жЌ®вј¤е¤љвј¤дєЋ 0пјЊиЇґжЋвЅ¤ж€·ж•°й‡Џе‘€дёЉеЌ‡и¶‹еЉїпјЊе…¶дё­е¦‚11вЅ‰26вЅ‡гЂЃ12вЅ‰2вЅ‡гЂЃ12вЅ‰7вЅ‡зљ„ж•°жЌ®еќ‡е°ЏдєЋ 0пјЊиЇґжЋз”Ёж€·ж•°й‡Џе‘€дё‹й™Ќи¶‹еЉїпјЊйњЂи¦Ѓз»“еђ€е…¶д»–ж•°жЌ®еЃљиї›вјЂж­Ґзљ„дё‹й™ЌеЋџе› е€†жћђгЂ‚иЂЊ12жњ€13ж—Ґе€°12жњ€18 ж—Ґзљ„ж•°жЌ®и™Ѕз„¶д№џе°ЏдєЋ 0пјЊдЅ†иЂѓи™‘ вЂњеЏЊвј—вј†вЂќ жґ»еЉЁеђЋвЅ¤ж€·е‘ЁзЋЇвЅђдјљз›ёеє”дё‹й™ЌпјЊе±ћдєЋж­ЈеёёзЋ°и±ЎгЂ‚</font>

<p>дёЂи€¬жќҐиЇґпјЊе‘ЁзЋЇжЇ”зљ„ж•°жЌ®еѕЂеѕЂжЇе¤§дєЋ 0 зљ„пјЊд»ЈиЎЁз”Ёж€·ж•°й‡Џе‘€дёЉеЌ‡и¶‹еЉїгЂ‚дЅ†жЇпјЊд»Ће›ѕдё­еЏЇд»Ґзњ‹е€°пјЊ11вЅ‰26вЅ‡гЂЃ12вЅ‰2вЅ‡гЂЃ12вЅ‰7вЅ‡зљ„ж•°жЌ®еќ‡е°ЏдєЋ 0пјЊиЇґжЋиї™е‡ е¤©зљ„з”Ёж€·ж•°з›ёжЇ”дёЂе‘Ёе‰Ќжњ‰ж‰Ђе‡Џе°‘пјЊе› ж­¤ж€‘д»¬йњЂи¦Ѓз»“еђ€е…¶д»–ж•°жЌ®иї›дёЂж­Ґе€†жћђе…¶дё‹й™Ќзљ„еЋџе› гЂ‚</p>

<p>йЂљеёёеЏЇиѓЅзљ„еЋџе› жњ‰пјљ</p>

<ul>
  <li>е†…йѓЁй—®йўпјљдє§е“Ѓ BUGпј€вЅ№з«™ bug еЅ±е“Ќз”Ёж€·дЅ“йЄЊпј‰гЂЃз­–з•Ґй—®йўпј€е‘Ёе№ґеє†жґ»еЉЁз»“жќџдє†пј‰гЂЃиђҐй”Ђй—®йўпј€д»Јвѕ”вј€жЌўдє†пј‰з­‰пј›</li>
  <li>е¤–йѓЁй—®йўпјљз«ће“Ѓжґ»еЉЁй—®йўпј€е…¶д»–е№іеЏ°вј¤й…¬е®ѕпј‰гЂЃж”їжІ»зЋЇеўѓй—®йўпј€иї›вјќе•†е“Ѓй™ђе€¶пј‰гЂЃи€†жѓ…вјќзў‘й—®йўпј€е№іеЏ°е•†е“Ѓз€†е‡єиґЁй‡Џй—®йўпј‰з­‰гЂ‚</li>
</ul>

<p>дЅ†жЇпјЊеЇ№дєЋдёЂдє›з‰№ж®Љзљ„ж—¶й—ґж®µпјЊдѕ‹е¦‚пјЊвЂњеЏЊеЌЃдєЊвЂќ жґ»еЉЁд№‹еђЋе‘ЁзЋЇжЇ”дё‹й™ЌдёЂи€¬е±ћдєЋж­ЈеёёзЋ°и±ЎгЂ‚е› дёєж­¤з±»жґ»еЉЁеѕЂеѕЂдјљз”±дєЋж‰“жЉдїѓй”Ђз­‰е› зґ пјЊдјљењЁзџ­жњџе†…еђёеј•е¤§й‡Џз”Ёж€·е…іжіЁпјЊд»ЋиЂЊеё¦жќҐеѕ€й«зљ„ UVпјЊиЂЊе¤§йѓЁе€†з”Ёж€·еѕЂеѕЂдјљи¶ЃжњєдёЂж¬ЎжЂ§иґ­д№°иѕѓе¤љдє§е“ЃпјЊе› ж­¤жґ»еЉЁд№‹еђЋдёЂж®µж—¶й—ґе†…иґ­з‰©йњЂж±‚дјљжњ‰ж‰Ђдё‹й™ЌпјЊиї™дє›йѓЅе±ћдєЋж­ЈеёёзЋ°и±ЎгЂ‚</p>

<p>еЅ“з„¶пјЊж€‘д»¬иїеЏЇд»ҐеЇ№е…¶д»–еџєзЎЂжЊ‡ж ‡пј€дѕ‹е¦‚пјљжµЏи§€ж·±еє¦гЂЃз•™е­зЋ‡з­‰пј‰иї›иЎЊз±»дјјзљ„е€†жћђе·ҐдЅњпјЊж­¤е¤„дёЌе†Ќе±•ејЂиµиї°гЂ‚</p>

<h3 id="72-зІѕз»†еЊ–иїђиђҐ">7.2 зІѕз»†еЊ–иїђиђҐ</h3>

<p>йЂљиї‡д№‹е‰ЌењЁ RFM жЁЎећ‹дё­еЇ№зљ„вЅ¤ж€·жњЂиї‘вјЂж¬Ўиґ­д№°ж—¶й—ґгЂЃвЅ¤ж€·ж¶€иґ№йў‘ж¬Ўе€†жћђпјЊж€‘д»¬е€†ж‹†еѕ—е€°дє†д»Ґдё‹ 4 з§Ќй‡Ќи¦ЃвЅ¤ж€·пјљ</p>

<ul>
  <li>й‡Ќи¦Ѓвѕјд»·еЂје®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиї‘вЅЅдё”ж¶€иґ№йў‘зЋ‡иѕѓвѕјзљ„е®ўж€·пј›</li>
  <li>й‡Ќи¦Ѓе”¤е›ће®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиїњдё”ж¶€иґ№йў‘зЋ‡иѕѓвѕјзљ„е®ўж€·пј›</li>
  <li>й‡Ќи¦Ѓж·±иЂ•е®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиї‘дё”ж¶€иґ№йў‘зЋ‡иѕѓдЅЋзљ„е®ўж€·пј›</li>
  <li>й‡Ќи¦ЃжЊЅз•™е®ўж€·пјљжЊ‡жњЂиї‘вјЂж¬Ўж¶€иґ№иѕѓиїњдё”ж¶€иґ№йў‘зЋ‡иѕѓдЅЋзљ„е®ўж€·гЂ‚</li>
</ul>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2021-07-03-WX20210703-235443%402x.png" width="100%" /></p>

<center><font size="2"><b>е›ѕ 3гЂЃе›ѕ 4пјљ</b>еђ„з”Ёж€·з±»ећ‹дё‹зљ„з”Ёж€·дєєж•°гЂЃеђ„з”Ёж€·з±»ећ‹е€†еёѓжѓ…е†µгЂ‚</font></center>

<p>ж€‘д»¬еЏЇд»ҐењЁеђЋз»­зІѕз»†еЊ–иїђиђҐењєж™Їдё­з›ґжЋҐдЅївЅ¤з»†е€†вЅ¤ж€·пјЊеЃље·®еј‚еЊ–иїђиђҐпјљ</p>

<ul>
  <li>еЇ№вѕјд»·еЂје®ўж€·еЃљ VIP жњЌеЉЎи®ѕи®ЎпјЊеўћеЉ вЅ¤ж€·зІжЂ§еђЊж—¶йЂљиї‡и®ѕи®Ўдјжѓ е€ёжЏђеЌ‡е®ўж€·ж¶€иґ№пј›</li>
  <li>еЇ№е”¤е›ће®ўж€·еЃље®љеђ‘вјґе‘ЉгЂЃзџ­дїЎеЏ¬е›ћз­–з•ҐпјЊе°ќиЇ•еЏ¬е›ћвЅ¤ж€·пј›</li>
  <li>еЇ№ж·±иЂ•е®ўж€·еЃљвјґе‘ЉгЂЃжЋЁйЂЃе€єжїЂпјЊжЏђеЌ‡ж¶€иґ№йў‘ж¬Ўпј›</li>
  <li>еЇ№жЊЅз•™е®ўж€·еЃљдјжѓ е€ёгЂЃз­ѕе€°йЂЃз¤јз­–з•ҐпјЊеўћеЉ жЊЅз•™вЅ¤ж€·зІжЂ§гЂ‚</li>
</ul>

<h3 id="73-е•†е“Ѓе€†жћђ">7.3 е•†е“Ѓе€†жћђ</h3>

<p>ж€‘д»¬ењЁд№‹е‰Ќе·Із»ЏеЇ№еђ„е•†е“Ѓе’Њеђ„е“Ѓз±»зљ„з‚№е‡»й‡ЏгЂЃж”¶и—Џй‡ЏгЂЃеЉ е…Ґиґ­з‰©иЅ¦зљ„ж¬Ўж•°гЂЃиґ­д№°ж¬Ўж•°е’Њиґ­д№°иЅ¬еЊ–зЋ‡йѓЅиї›иЎЊдє†з»џи®ЎгЂ‚</p>

<p>дё‹йќўжЇеџєдєЋиґ­д№°й‡Џз»џи®Ўеѕ—е€°зљ„жЋ’еђЌе‰Ќ 10 зљ„е•†е“Ѓе“Ѓз±»еЏЉз›ёе…іжЊ‡ж ‡пјљ</p>

<table>
  <thead>
    <tr>
      <th>item_category</th>
      <th>pv</th>
      <th>favorite</th>
      <th>cart</th>
      <th>purchase</th>
      <th>purchase_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>13230</td>
      <td>1481</td>
      <td>2</td>
      <td>35</td>
      <td>43</td>
      <td>12.50%</td>
    </tr>
    <tr>
      <td>5894</td>
      <td>1336</td>
      <td>2</td>
      <td>20</td>
      <td>36</td>
      <td>12.36%</td>
    </tr>
    <tr>
      <td>1863</td>
      <td>1461</td>
      <td>11</td>
      <td>41</td>
      <td>34</td>
      <td>11.37%</td>
    </tr>
    <tr>
      <td>6513</td>
      <td>1030</td>
      <td>7</td>
      <td>29</td>
      <td>31</td>
      <td>13.44%</td>
    </tr>
    <tr>
      <td>11279</td>
      <td>767</td>
      <td>4</td>
      <td>22</td>
      <td>25</td>
      <td>12.59%</td>
    </tr>
    <tr>
      <td>10894</td>
      <td>491</td>
      <td>2</td>
      <td>15</td>
      <td>20</td>
      <td>12.61%</td>
    </tr>
    <tr>
      <td>5027</td>
      <td>1498</td>
      <td>2</td>
      <td>27</td>
      <td>19</td>
      <td>7.32%</td>
    </tr>
    <tr>
      <td>2825</td>
      <td>608</td>
      <td>0</td>
      <td>11</td>
      <td>15</td>
      <td>9.30%</td>
    </tr>
    <tr>
      <td>5399</td>
      <td>1131</td>
      <td>4</td>
      <td>18</td>
      <td>15</td>
      <td>4.88%</td>
    </tr>
    <tr>
      <td>4370</td>
      <td>493</td>
      <td>4</td>
      <td>15</td>
      <td>13</td>
      <td>8.97%</td>
    </tr>
  </tbody>
</table>

<p>еЏЇд»Ґзњ‹е€°пјЊе…¶дё­ ID дёє <code class="language-plaintext highlighter-rouge">5027</code>гЂЃ<code class="language-plaintext highlighter-rouge">5399</code> зљ„е•†е“Ѓе“Ѓз±»зљ„иґ­д№°иЅ¬еЊ–зЋ‡иѕѓе…¶дЅ™е•†е“Ѓе“Ѓз±»еЃЏдЅЋгЂ‚е› ж­¤пјЊйњЂи¦Ѓз»“еђ€ж›ґе¤љж•°жЌ®еЃљиї›вјЂж­Ґи§ЈиЇ»пј€еЏЇиѓЅзљ„еЋџе› пјље“Ѓз±»вѕѓжњ‰з‰№жЂ§еЇји‡ґвЅ¤ж€·иґ­д№°иѕѓдЅЋпјЊвЅђе¦‚вѕ®еї…йњЂе“ЃгЂЃеҐўдѕ€е“Ѓз­‰з­‰пј‰гЂ‚</p>

<h3 id="74-дє§е“ЃеЉџиѓЅи·Їеѕ„е€†жћђ">7.4 дє§е“ЃеЉџиѓЅи·Їеѕ„е€†жћђ</h3>

<p>д»Ґдё‹дёєдё»и¦Ѓиґ­д№°и·Їеѕ„е’ЊеЇ№еє”зљ„з”Ёж€·дєєж•°пјљ</p>

<table>
  <thead>
    <tr>
      <th>behavior_path</th>
      <th>user_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>з©є-з©є-з©є-з©є-2</td>
      <td>146</td>
    </tr>
    <tr>
      <td>з©є-з©є-з©є-1-2</td>
      <td>64</td>
    </tr>
    <tr>
      <td>з©є-з©є-1-1-2</td>
      <td>10</td>
    </tr>
    <tr>
      <td>з©є-з©є-2-1-2</td>
      <td>2</td>
    </tr>
    <tr>
      <td>з©є-з©є-з©є-3-2</td>
      <td>2</td>
    </tr>
    <tr>
      <td>з©є-1-1-1-2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>з©є-з©є-1-3-2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>з©є-з©є-з©є-2-2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>ж€‘д»¬еЏЇд»ҐеЏ‘зЋ°пјљ</p>

<ul>
  <li>вЅ¤ж€·е¤љд»Ґз›ґжЋҐиґ­д№°дёєдё»пј›</li>
  <li>ж·»еЉ иґ­з‰©в»‹зљ„иґ­д№°ењЁдё»и¦Ѓиґ­д№°и·Їеѕ„дё­ж•°й‡Џиѕѓе°‘гЂ‚</li>
</ul>

<p>д№џе°±жЇиЇґпјЊз›®е‰Ќз”Ёж€·ењЁиґ­д№°е•†е“Ѓж—¶еЇ№дєЋж·»еЉ иґ­з‰©иЅ¦е’Њж”¶и—ЏеЉџиѓЅдЅїз”Ёйў‘зЋ‡еѕ€дЅЋпјЊиї™иЇґжЋе№іеЏ°ењЁиї™дё¤йЎ№еЉџиѓЅзљ„з”Ёж€·дЅ“йЄЊж–№йќўеЏЇиѓЅе­ењЁдёЂдє›й—®йўгЂ‚жѓіи±ЎдёЂдё‹пјЊе¦‚жћњжЇЏж¬Ўз”Ёж€·ењЁиґ­д№°е•†е“Ѓж—¶йѓЅжЇз›ґжЋҐж”Їд»пјЊй‚Јд№€з›ёеЅ“дєЋжЇЏж¬ЎеЏЄиґ­д№°дє†дёЂд»¶е•†е“Ѓпј›иЂЊе¦‚жћњз”Ёж€·д№ жѓЇдєЋдЅїз”Ёиґ­з‰©иЅ¦еЉџиѓЅпјЊй‚Јд№€еѕ€жњ‰еЏЇиѓЅдјљжЇЏж¬Ўиґ­д№°е¤љд»¶е•†е“ЃпјЊд»ЋиЂЊењЁе№іеЏ°ж¶€иґ№ж›ґе¤љй‡‘йўќгЂ‚</p>

<p>е› ж­¤пјЊеђЋз»­еЇ№дєЋдє§е“Ѓзљ„еЉ е…Ґиґ­з‰©иЅ¦еЉџиѓЅе’Њж”¶и—ЏеЉџиѓЅиїйњЂи¦Ѓз»“еђ€ж›ґе¤љж•°жЌ®еЃљж”№иї›вЅ…жЎ€гЂ‚</p>

<p>д»ҐдёЉе°±жЇж€‘д»¬ж №жЌ®е‰ЌйќўжЏђеЏ–зљ„ж•°жЌ®жЊ‡ж ‡е€ќж­Ґе€†жћђе‡єзљ„дёЂдє›ж–№еђ‘жЂ§зљ„з»“жћњпјЊеђЋз»­иїеЏЇд»Ґз»“еђ€ж›ґе¤љжЊ‡ж ‡иї›иЎЊж›ґеЉ зІѕз»†еЊ–зљ„ж·±е…Ґе€†жћђгЂ‚</p>
:ET