I"*¤<h1 id="lecture-13-nn-ç½‘ç»œå±‚æ± åŒ–å±‚å…¨è¿æ¥å±‚å’Œæ¿€æ´»å‡½æ•°å±‚">Lecture 13 nn ç½‘ç»œå±‚ï¼šæ± åŒ–å±‚ã€å…¨è¿æ¥å±‚å’Œæ¿€æ´»å‡½æ•°å±‚</h1>

<p>ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ç½‘ç»œå±‚ä¸­çš„å·ç§¯å±‚ã€‚æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­å­¦ä¹ å…¶ä»–å‡ ç§ç½‘ç»œå±‚ï¼šæ± åŒ–å±‚ã€çº¿æ€§å±‚å’Œæ¿€æ´»å‡½æ•°å±‚ã€‚</p>

<h2 id="1-æ± åŒ–å±‚">1. æ± åŒ–å±‚</h2>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-mp.gif" width="60%" /></p>

<p><strong>æ± åŒ–è¿ç®— (Pooling)</strong>ï¼šå¯¹ä¿¡å·è¿›è¡Œ <strong>â€œæ”¶é›†â€</strong> å¹¶ <strong>â€œæ€»ç»“â€</strong>ï¼Œç±»ä¼¼æ°´æ± æ”¶é›†æ°´èµ„æºï¼Œå› è€Œå¾—åæ± åŒ–å±‚ã€‚</p>

<ul>
  <li><strong>â€œæ”¶é›†â€</strong>ï¼šå¤šå˜å°‘ã€‚</li>
  <li><strong>â€œæ€»ç»“â€</strong>ï¼šæœ€å¤§å€¼/å¹³å‡å€¼ã€‚</li>
</ul>

<p><strong>æœ€å¤§æ± åŒ– vs. å¹³å‡æ± åŒ–</strong>ï¼š</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-Illustration-of-Max-Pooling-and-Average-Pooling-Figure-2-above-shows-an-example-of-max.png" width="60%" /></p>

<h4 id="nnmaxpool2d"><code class="language-plaintext highlighter-rouge">nn.MaxPool2d</code></h4>

<p><strong>åŠŸèƒ½</strong>ï¼šå¯¹äºŒç»´ä¿¡å·ï¼ˆå›¾åƒï¼‰è¿›è¡Œæœ€å¤§å€¼æ± åŒ–ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">nn</span><span class="p">.</span><span class="n">MaxPool2d</span><span class="p">(</span>
    <span class="n">kernel_size</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">return_indices</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">ceil_mode</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ä¸»è¦å‚æ•°</strong>ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">kernel_size</code>ï¼šæ± åŒ–æ ¸å°ºå¯¸ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">stride</code>ï¼šæ­¥é•¿ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">padding</code>ï¼šå¡«å……ä¸ªæ•°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">dilation</code>ï¼šæ± åŒ–æ ¸é—´éš”å¤§å°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">ceil_mode</code>ï¼šå°ºå¯¸æ˜¯å¦å‘ä¸Šå–æ•´ã€‚ç”¨äºè®¡ç®—è¾“å‡ºç‰¹å¾å›¾å°ºå¯¸ï¼Œé»˜è®¤è®¾ç½®ä¸ºå‘ä¸‹å–æ•´ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">return_indices</code>ï¼šè®°å½•æ± åŒ–åƒç´ ç´¢å¼•ã€‚é€šå¸¸åœ¨æœ€å¤§å€¼åæ± åŒ–ä¸Šé‡‡æ ·æ—¶ä½¿ç”¨ã€‚</li>
</ul>

<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">tools.common_tools</span> <span class="kn">import</span> <span class="n">transform_invert</span><span class="p">,</span> <span class="n">set_seed</span>

<span class="n">set_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># è®¾ç½®éšæœºç§å­
</span>
<span class="c1"># ================================= load img ==================================
</span><span class="n">path_img</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">"lena.png"</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path_img</span><span class="p">).</span><span class="n">convert</span><span class="p">(</span><span class="s">'RGB'</span><span class="p">)</span>  <span class="c1"># 0~255
</span>
<span class="c1"># convert to tensor
</span><span class="n">img_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">transforms</span><span class="p">.</span><span class="n">ToTensor</span><span class="p">()])</span>
<span class="n">img_tensor</span> <span class="o">=</span> <span class="n">img_transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">img_tensor</span><span class="p">.</span><span class="n">unsqueeze_</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># C*H*W to B*C*H*W
</span>
<span class="c1"># ========================== create maxpool layer =============================
</span><span class="n">maxpool_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">MaxPool2d</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>   <span class="c1"># input:(i, o, size) weights:(o, i , h, w)
</span><span class="n">img_pool</span> <span class="o">=</span> <span class="n">maxpool_layer</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>

<span class="c1"># ================================= visualization =============================
</span><span class="k">print</span><span class="p">(</span><span class="s">"æ± åŒ–å‰å°ºå¯¸:{}</span><span class="se">\n</span><span class="s">æ± åŒ–åå°ºå¯¸:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">img_pool</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">img_pool</span> <span class="o">=</span> <span class="n">transform_invert</span><span class="p">(</span><span class="n">img_pool</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">...],</span> <span class="n">img_transform</span><span class="p">)</span>
<span class="n">img_raw</span> <span class="o">=</span> <span class="n">transform_invert</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">img_transform</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">).</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_pool</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">).</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_raw</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>æ± åŒ–å‰å°ºå¯¸:torch.Size([1, 3, 512, 512])
æ± åŒ–åå°ºå¯¸:torch.Size([1, 3, 256, 256])
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-WX20201216-193358%402x.png" width="60%" /></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡æœ€å¤§æ± åŒ–åçš„å›¾åƒå°ºå¯¸å‡å°äº†ä¸€åŠï¼Œè€Œå›¾åƒè´¨é‡å¹¶æ²¡æœ‰æ˜æ˜¾é™ä½ã€‚å› æ­¤ï¼Œæ± åŒ–æ“ä½œå¯ä»¥å‰”é™¤å›¾åƒä¸­çš„å†—ä½™ä¿¡æ¯ï¼Œä»¥åŠå‡å°åç»­çš„è®¡ç®—é‡ã€‚</p>

<h4 id="nnavgpool2d"><code class="language-plaintext highlighter-rouge">nn.AvgPool2d</code></h4>

<p><strong>åŠŸèƒ½</strong>ï¼šå¯¹äºŒç»´ä¿¡å·ï¼ˆå›¾åƒï¼‰è¿›è¡Œå¹³å‡å€¼æ± åŒ–ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">nn</span><span class="p">.</span><span class="n">AvgPool2d</span><span class="p">(</span>
    <span class="n">kernel_size</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">ceil_mode</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">count_include_pad</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">divisor_override</span><span class="o">=</span><span class="bp">None</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ä¸»è¦å‚æ•°</strong>ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">kernel_size</code>ï¼šæ± åŒ–æ ¸å°ºå¯¸ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">stride</code>ï¼šæ­¥é•¿ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">padding</code>ï¼šå¡«å……ä¸ªæ•°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">ceil_mode</code>ï¼šå°ºå¯¸å‘ä¸Šå–æ•´ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">count_include_pad</code>ï¼šæ˜¯å¦å°†å¡«å……å€¼ç”¨äºå¹³å‡å€¼çš„è®¡ç®—ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">divisor_override</code>ï¼šé™¤æ³•å› å­ã€‚è®¡ç®—å¹³å‡å€¼æ—¶ä»£æ›¿åƒç´ ä¸ªæ•°ä½œä¸ºåˆ†æ¯ã€‚</li>
</ul>

<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">tools.common_tools</span> <span class="kn">import</span> <span class="n">transform_invert</span><span class="p">,</span> <span class="n">set_seed</span>

<span class="n">set_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># è®¾ç½®éšæœºç§å­
</span>
<span class="c1"># ================================= load img ==================================
</span><span class="n">path_img</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">"lena.png"</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path_img</span><span class="p">).</span><span class="n">convert</span><span class="p">(</span><span class="s">'RGB'</span><span class="p">)</span>  <span class="c1"># 0~255
</span>
<span class="c1"># convert to tensor
</span><span class="n">img_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">transforms</span><span class="p">.</span><span class="n">ToTensor</span><span class="p">()])</span>
<span class="n">img_tensor</span> <span class="o">=</span> <span class="n">img_transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">img_tensor</span><span class="p">.</span><span class="n">unsqueeze_</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># C*H*W to B*C*H*W
</span>
<span class="c1"># ========================== create avgpool layer =============================
</span><span class="n">avgpoollayer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">AvgPool2d</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>   <span class="c1"># input:(i, o, size) weights:(o, i , h, w)
</span><span class="n">img_pool</span> <span class="o">=</span> <span class="n">avgpoollayer</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>

<span class="c1"># =============================== visualization ===============================
</span><span class="k">print</span><span class="p">(</span><span class="s">"æ± åŒ–å‰å°ºå¯¸:{}</span><span class="se">\n</span><span class="s">æ± åŒ–åå°ºå¯¸:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">img_pool</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">img_pool</span> <span class="o">=</span> <span class="n">transform_invert</span><span class="p">(</span><span class="n">img_pool</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">...],</span> <span class="n">img_transform</span><span class="p">)</span>
<span class="n">img_raw</span> <span class="o">=</span> <span class="n">transform_invert</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">img_transform</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">).</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_pool</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">).</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_raw</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>æ± åŒ–å‰å°ºå¯¸:torch.Size([1, 3, 512, 512])
æ± åŒ–åå°ºå¯¸:torch.Size([1, 3, 256, 256])
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-WX20201216-195332%402x.png" width="60%" /></p>

<p>åŒæ ·ï¼Œå›¾åƒå°ºå¯¸å‡å°äº†ä¸€åŠï¼Œè€Œè´¨é‡å¹¶æ²¡æœ‰æ˜æ˜¾é™ä½ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä»”ç»†å¯¹æ¯”æœ€å¤§æ± åŒ–ä¸å¹³å‡æ± åŒ–çš„ç»“æœï¼Œå¯ä»¥å‘ç°æœ€å¤§æ± åŒ–åçš„å›¾åƒä¼šåäº®ä¸€äº›ï¼Œè€Œå¹³å‡æ± åŒ–åçš„å›¾åƒä¼šåæš—ä¸€äº›ï¼Œè¿™æ˜¯ç”±äºä¸¤ç§æ± åŒ–æ“ä½œé‡‡ç”¨ä¸åŒçš„è®¡ç®—æ–¹å¼é€ æˆçš„ (åƒç´ å€¼è¶Šå¤§ï¼Œå›¾åƒäº®åº¦è¶Šé«˜)ã€‚</p>

<h5 id="divisor_override-çš„ä½¿ç”¨"><code class="language-plaintext highlighter-rouge">divisor_override</code> çš„ä½¿ç”¨</h5>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹é™¤æ³•å› å­çš„ä½¿ç”¨ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª $4\times 4$ çš„å›¾åƒï¼Œå¹¶ä¸”é‡‡ç”¨ä¸€ä¸ª $2\times 2$ çš„çª—å£ï¼Œæ­¥é•¿è®¾ç½®ä¸º $2$ã€‚</p>

<p><strong>æ­£å¸¸çš„å¹³å‡æ± åŒ–</strong>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">img_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">avgpool_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">AvgPool2d</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">img_pool</span> <span class="o">=</span> <span class="n">avgpool_layer</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"raw_img:</span><span class="se">\n</span><span class="s">{}</span><span class="se">\n</span><span class="s">pooling_img:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">,</span> <span class="n">img_pool</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>raw_img:
tensor([[[[1., 1., 1., 1.],
          [1., 1., 1., 1.],
          [1., 1., 1., 1.],
          [1., 1., 1., 1.]]]])
pooling_img:
tensor([[[[1., 1.],
          [1., 1.]]]])
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è®¡ç®—æ± åŒ–åçš„åƒç´ å€¼ï¼š</p>

\[\dfrac{1+1+1+1}{4} = 1\]

<p><strong><code class="language-plaintext highlighter-rouge">divisor_override=3</code> çš„å¹³å‡æ± åŒ–</strong>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">img_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">avgpool_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">AvgPool2d</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">divisor_override</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">img_pool</span> <span class="o">=</span> <span class="n">avgpool_layer</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"raw_img:</span><span class="se">\n</span><span class="s">{}</span><span class="se">\n</span><span class="s">pooling_img:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">,</span> <span class="n">img_pool</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>raw_img:
tensor([[[[1., 1., 1., 1.],
          [1., 1., 1., 1.],
          [1., 1., 1., 1.],
          [1., 1., 1., 1.]]]])
pooling_img:
tensor([[[[1.3333, 1.3333],
          [1.3333, 1.3333]]]])
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è®¡ç®—æ± åŒ–åçš„åƒç´ å€¼ï¼š</p>

\[\dfrac{1+1+1+1}{3} = 1.3333\]

<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–ï¼Œå®ƒä»¬éƒ½æ˜¯å¯¹å›¾åƒå®ç°ä¸‹é‡‡æ ·çš„è¿‡ç¨‹ï¼Œå³è¾“å…¥å°ºå¯¸è¾ƒå¤§çš„å›¾åƒï¼Œè¾“å‡ºå°ºå¯¸è¾ƒå°çš„å›¾åƒã€‚ä¸‹é¢æˆ‘ä»¬å°†å­¦ä¹ åæ± åŒ–ï¼Œå³å°†å°å°ºå¯¸å›¾åƒå˜ä¸ºå¤§å°ºå¯¸å›¾åƒã€‚</p>

<h4 id="nnmaxunpool2d"><code class="language-plaintext highlighter-rouge">nn.MaxUnpool2d</code></h4>

<p><strong>åŠŸèƒ½</strong>ï¼šå¯¹äºŒç»´ä¿¡å·ï¼ˆå›¾åƒï¼‰è¿›è¡Œæœ€å¤§å€¼åæ± åŒ–ä¸Šé‡‡æ ·ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>
<span class="n">nn</span><span class="p">.</span><span class="n">MaxUnpool2d</span><span class="p">(</span>
    <span class="n">kernel_size</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">padding</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ä¸»è¦å‚æ•°</strong>ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">kernel_size</code>ï¼šæ± åŒ–æ ¸å°ºå¯¸ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">stride</code>ï¼šæ­¥é•¿ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">padding</code>ï¼šå¡«å……ä¸ªæ•°ã€‚</li>
</ul>

<p><strong>æœ€å¤§å€¼åæ± åŒ–ï¼š</strong></p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-null-16.png" width="80%" /></p>

<p>æ—©æœŸçš„è‡ªç¼–ç å™¨å’Œå›¾åƒåˆ†å‰²ä»»åŠ¡ä¸­éƒ½ä¼šæ¶‰åŠä¸€ä¸ªä¸Šé‡‡æ ·çš„æ“ä½œï¼Œå½“æ—¶æ™®éé‡‡ç”¨çš„æ–¹æ³•æ˜¯æœ€å¤§å€¼åæ± åŒ–ä¸Šé‡‡æ ·ã€‚ä¸Šå›¾å·¦åŠéƒ¨åˆ†æ˜¯æœ€å¤§æ± åŒ–è¿‡ç¨‹ï¼ŒåŸå§‹ $4\times 4$ çš„å›¾åƒç»è¿‡æœ€å¤§æ± åŒ–åå¾—åˆ°ä¸€ä¸ª $2\times 2$ çš„ä¸‹é‡‡æ ·å›¾åƒï¼Œç„¶åç»è¿‡ä¸€ç³»åˆ—çš„ç½‘ç»œå±‚ä¹‹åï¼Œè¿›å…¥ä¸Šå›¾å³åŠéƒ¨åˆ†çš„ä¸Šé‡‡æ ·è§£ç å™¨ï¼Œå³å°†ä¸€ä¸ªå°ºå¯¸è¾ƒå°çš„å›¾åƒç»è¿‡ä¸Šé‡‡æ ·å¾—åˆ°ä¸€ä¸ªå°ºå¯¸è¾ƒå¤§çš„å›¾åƒã€‚æ­¤æ—¶ï¼Œæ¶‰åŠåˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæˆ‘ä»¬åº”è¯¥å°†åƒç´ å€¼æ”¾åˆ°ä»€ä¹ˆä½ç½®ã€‚ä¾‹å¦‚ï¼šå³è¾¹ $2\times 2$ å›¾åƒä¸­çš„å·¦ä¸Šè§’çš„ $3$ åº”å½“æ”¾å…¥æœ€ç»ˆ $4\times 4$ å›¾åƒä¸­çš„å·¦ä¸Šéƒ¨åˆ†çš„ $4$ ä¸ªåƒç´ ä¸­çš„å“ªä¸€ä¸ªï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¹‹å‰æœ€å¤§æ± åŒ–è¿‡ç¨‹ä¸­è®°å½•çš„æ± åŒ–åƒç´ ç´¢å¼•ï¼Œå°† $3$ æ”¾å…¥ä¹‹å‰åŸå§‹ $4\times 4$ å›¾åƒä¸­å·¦ä¸Šè§’çš„ $4$ ä¸ªåƒç´ ä¸­æœ€å¤§å€¼å¯¹åº”çš„ä½ç½®ã€‚</p>

<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1"># pooling
</span><span class="n">img_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
<span class="n">maxpool_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">MaxPool2d</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">return_indices</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">img_pool</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">maxpool_layer</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>

<span class="c1"># unpooling
</span><span class="n">img_reconstruct</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">img_pool</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
<span class="n">maxunpool_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">MaxUnpool2d</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">img_unpool</span> <span class="o">=</span> <span class="n">maxunpool_layer</span><span class="p">(</span><span class="n">img_reconstruct</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"raw_img:</span><span class="se">\n</span><span class="s">{}</span><span class="se">\n</span><span class="s">img_pool:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">,</span> <span class="n">img_pool</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"img_reconstruct:</span><span class="se">\n</span><span class="s">{}</span><span class="se">\n</span><span class="s">img_unpool:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">img_reconstruct</span><span class="p">,</span> <span class="n">img_unpool</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>raw_img:
tensor([[[[0., 4., 4., 3.],
          [3., 3., 1., 1.],
          [4., 2., 3., 4.],
          [1., 3., 3., 0.]]]])
img_pool:
tensor([[[[4., 4.],
          [4., 4.]]]])
img_reconstruct:
tensor([[[[-1.0276, -0.5631],
          [-0.8923, -0.0583]]]])
img_unpool:
tensor([[[[ 0.0000, -1.0276, -0.5631,  0.0000],
          [ 0.0000,  0.0000,  0.0000,  0.0000],
          [-0.8923,  0.0000,  0.0000, -0.0583],
          [ 0.0000,  0.0000,  0.0000,  0.0000]]]])
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª $4\times 4$ çš„å›¾åƒï¼Œå¹¶ä¸”é‡‡ç”¨ä¸€ä¸ª $2\times 2$ çš„çª—å£ï¼Œæ­¥é•¿è®¾ç½®ä¸º $2$ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œæœ€å¤§å€¼æ± åŒ–ï¼Œå¹¶è®°å½•å…¶ä¸­çš„æœ€å¤§å€¼åƒç´ çš„ç´¢å¼•ã€‚ç„¶åï¼Œæˆ‘ä»¬è¿›è¡Œåæ± åŒ–ï¼Œè¿™é‡Œåæ± åŒ–çš„è¾“å…¥å’Œä¹‹å‰æœ€å¤§æ± åŒ–åå¾—åˆ°çš„å›¾åƒå°ºå¯¸æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”åæ± åŒ–å±‚çš„çª—å£å’Œæ­¥é•¿ä¸ä¹‹å‰æœ€å¤§æ± åŒ–å±‚æ˜¯ä¸€è‡´çš„ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¾“å…¥å’Œç´¢å¼•ä¼ å…¥åæ± åŒ–å±‚ï¼Œå¾—åˆ°ä¸åŸå§‹å›¾åƒå°ºå¯¸ç›¸åŒçš„å›¾åƒã€‚</p>

<h2 id="2-çº¿æ€§å±‚">2. çº¿æ€§å±‚</h2>

<p><strong>çº¿æ€§å±‚ (Linear Layer)</strong> åˆç§° <strong>å…¨è¿æ¥å±‚ (Full-connected Layer)</strong>ï¼Œå…¶æ¯ä¸ªç¥ç»å…ƒä¸ä¸Šä¸€å±‚æ‰€æœ‰ç¥ç»å…ƒç›¸è¿ï¼Œå®ç°å¯¹å‰ä¸€å±‚çš„ <strong>çº¿æ€§ç»„åˆ/çº¿æ€§å˜æ¢</strong>ã€‚</p>

<p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œåˆ†ç±»çš„æ—¶å€™ï¼Œåœ¨è¾“å‡ºä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡‡ç”¨ä¸€ä¸ªå…¨è¿æ¥å±‚å¯¹ç‰¹å¾è¿›è¡Œå¤„ç†ï¼Œåœ¨ PyTorch ä¸­ï¼Œå…¨è¿æ¥å±‚åˆç§°ä¸ºçº¿æ€§å±‚ï¼Œå› ä¸ºå¦‚æœä¸è€ƒè™‘æ¿€æ´»å‡½æ•°çš„éçº¿æ€§æ€§è´¨ï¼Œé‚£ä¹ˆå…¨è¿æ¥å±‚å°±æ˜¯å¯¹è¾“å…¥æ•°æ®è¿›è¡Œä¸€ä¸ªçº¿æ€§ç»„åˆã€‚</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-WX20201216-205835%402x.png" width="80%" /></p>

<p>æ¯ä¸ªç¥ç»å…ƒéƒ½å’Œå‰ä¸€å±‚ä¸­çš„æ‰€æœ‰ç¥ç»å…ƒç›¸è¿ï¼Œæ¯ä¸ªç¥ç»å…ƒçš„è®¡ç®—æ–¹å¼æ˜¯å¯¹ä¸Šä¸€å±‚çš„åŠ æƒæ±‚å’Œçš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œçº¿æ€§å±‚å¯ä»¥é‡‡ç”¨çŸ©é˜µä¹˜æ³•æ¥å®ç°ã€‚æ³¨æ„ï¼Œä¸Šå›¾ä¸­æˆ‘ä»¬æš‚æ—¶å¿½ç•¥äº†åç½®é¡¹ã€‚</p>

<h4 id="nnlinear"><code class="language-plaintext highlighter-rouge">nn.Linear</code></h4>

<p><strong>åŠŸèƒ½</strong>ï¼šå¯¹ä¸€ç»´ä¿¡å·ï¼ˆå‘é‡ï¼‰è¿›è¡Œçº¿æ€§ç»„åˆã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">out_features</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ä¸»è¦å‚æ•°</strong>ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">in_features</code>ï¼šè¾“å…¥ç»“ç‚¹æ•°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">out_features</code>ï¼šè¾“å‡ºç»“ç‚¹æ•°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">bias</code>ï¼šæ˜¯å¦éœ€è¦åç½®ã€‚</li>
</ul>

<p><strong>è®¡ç®—å…¬å¼</strong>ï¼š</p>

\[y = x W^{\mathrm T} + \text{bias}\]

<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="n">linear_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">linear_layer</span><span class="p">.</span><span class="n">weight</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                                         <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
                                         <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span>
                                         <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">]])</span>
<span class="n">linear_layer</span><span class="p">.</span><span class="n">bias</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">fill_</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">linear_layer</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">inputs</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">linear_layer</span><span class="p">.</span><span class="n">weight</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">linear_layer</span><span class="p">.</span><span class="n">weight</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">output</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>tensor([[1., 2., 3.]]) torch.Size([1, 3])
tensor([[1., 1., 1.],
        [2., 2., 2.],
        [3., 3., 3.],
        [4., 4., 4.]]) torch.Size([4, 3])
tensor([[ 6.5000, 12.5000, 18.5000, 24.5000]], grad_fn=&lt;AddmmBackward&gt;) torch.Size([1, 4])
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="3-æ¿€æ´»å‡½æ•°å±‚">3. æ¿€æ´»å‡½æ•°å±‚</h2>

<p><strong>æ¿€æ´»å‡½æ•° (Activation Function)</strong> æ˜¯å¯¹ç‰¹å¾è¿›è¡Œéçº¿æ€§å˜æ¢ï¼Œèµ‹äºˆå¤šå±‚ç¥ç»ç½‘ç»œå…·æœ‰ <strong>æ·±åº¦</strong> çš„æ„ä¹‰ã€‚</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-WX20201216-221810%402x.png" width="80%" /></p>

<p>åœ¨ä¸Šé¢æœ€åä¸€æ­¥ä¸­ï¼Œç”±äºçŸ©é˜µä¹˜æ³•çš„ç»“åˆæ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå³è¾¹ä¸‰ä¸ªæƒé‡çŸ©é˜µå…ˆç»“åˆç›¸ä¹˜ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå¤§çš„æƒé‡çŸ©é˜µ $W$ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„ $\textit{Output}$ å®é™…ä¸Šå°±æ˜¯è¾“å…¥ $X$ ä¹˜ä»¥ä¸€ä¸ªå¤§çš„æƒé‡çŸ©é˜µ $W$ã€‚å› æ­¤ï¼Œè¿™é‡Œçš„ä¸‰å±‚çº¿æ€§å…¨è¿æ¥å±‚å®é™…ä¸Šç­‰ä»·äºä¸€ä¸ªä¸€å±‚çš„å…¨è¿æ¥å±‚ï¼Œè¿™æ˜¯ç”±äºçº¿æ€§è¿ç®—å½“ä¸­çŸ©é˜µä¹˜æ³•çš„ç»“åˆæ€§å¯¼è‡´çš„ï¼Œå¹¶ä¸”è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰å¼•å…¥éçº¿æ€§æ¿€æ´»å‡½æ•°ã€‚å¦‚æœåŠ ä¸Š <strong>éçº¿æ€§æ¿€æ´»å‡½æ•°</strong>ï¼Œè¿™ä¸€ç»“è®ºå°†ä¸å†æˆç«‹ï¼Œå› æ­¤æˆ‘ä»¬è¯´ï¼Œæ¿€æ´»å‡½æ•°èµ‹äºˆäº†å¤šå±‚ç¥ç»ç½‘ç»œå…·æœ‰ <strong>æ·±åº¦</strong> çš„æ„ä¹‰ã€‚</p>

<h4 id="nnsigmoid"><code class="language-plaintext highlighter-rouge">nn.Sigmoid</code></h4>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-sigmoid.png" width="60%" /></p>

<p><strong>è®¡ç®—å…¬å¼</strong>ï¼š</p>

\[y = \dfrac{1}{1+e^{-x}}\]

<p><strong>æ¢¯åº¦å…¬å¼</strong>ï¼š</p>

\[y' = y*(1-y)\]

<p><strong>ç‰¹æ€§</strong>ï¼š</p>

<ul>
  <li>è¾“å‡ºå€¼åœ¨ $(0,1)$ï¼Œç¬¦åˆæ¦‚ç‡æ€§è´¨ã€‚</li>
  <li>å¯¼æ•°èŒƒå›´æ˜¯ $[0, 0.25]$ï¼Œå®¹æ˜“å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚</li>
  <li>è¾“å‡ºä¸ºé $0$ å‡å€¼ï¼Œä¼šç ´åæ•°æ®åˆ†å¸ƒã€‚</li>
</ul>

<h4 id="nntanh"><code class="language-plaintext highlighter-rouge">nn.tanh</code></h4>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-tanh.png" width="60%" /></p>

<p><strong>è®¡ç®—å…¬å¼</strong>ï¼š</p>

\[y= \dfrac{\sin x}{\cos x}=\dfrac{e^x - e^{-x}}{e^x + e^{-x}} = \dfrac{2}{1+e^{-2x}}+1\]

<p><strong>æ¢¯åº¦å…¬å¼</strong>ï¼š</p>

\[y' = 1- y^2\]

<p><strong>ç‰¹æ€§</strong>ï¼š</p>

<ul>
  <li>è¾“å‡ºå€¼åœ¨ $(- 1,1)$ï¼Œæ•°æ®ç¬¦åˆ $0$ å‡å€¼ã€‚</li>
  <li>å¯¼æ•°èŒƒå›´æ˜¯ $(0, 1)$ï¼Œå®¹æ˜“å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚</li>
</ul>

<h4 id="nnrelu"><code class="language-plaintext highlighter-rouge">nn.ReLU</code></h4>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-relu.png" width="60%" /></p>

<p><strong>è®¡ç®—å…¬å¼</strong>ï¼š</p>

\[y= \max(0,x)\]

<p><strong>æ¢¯åº¦å…¬å¼</strong>ï¼š</p>

\[y'=\begin{cases}1\,, &amp; x &gt; 0 \\[2ex] \text{undefined}\,, &amp; x=0 \\[2ex]0\,, &amp; x &lt; 0\end{cases}\]

<p><strong>ç‰¹æ€§</strong>ï¼š</p>

<ul>
  <li>è¾“å‡ºå€¼å‡ä¸ºæ­£æ•°ï¼Œè´ŸåŠè½´å¯¼è‡´æ­»ç¥ç»å…ƒã€‚</li>
  <li>å¯¼æ•°æ˜¯ $1$ï¼Œå¯ä»¥ç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†å®¹æ˜“å¼•å‘æ¢¯åº¦çˆ†ç‚¸ã€‚</li>
</ul>

<p>é’ˆå¯¹ ReLU æ¿€æ´»å‡½æ•°è´ŸåŠè½´æ­»ç¥ç»å…ƒçš„é—®é¢˜ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ”¹è¿›æ–¹å¼ï¼š</p>

<p><img src="http://andy-blog.oss-cn-beijing.aliyuncs.com/blog/2020-12-16-Lrelu.png" width="60%" /></p>

<h4 id="nnleakyrelu"><code class="language-plaintext highlighter-rouge">nn.LeakyReLU</code></h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">negative_slope</code>ï¼šè´ŸåŠè½´æ–œç‡ã€‚</li>
</ul>

<h4 id="nnprelu"><code class="language-plaintext highlighter-rouge">nn.PReLU</code></h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">init</code>ï¼šå¯å­¦ä¹ æ–œç‡ã€‚</li>
</ul>

<h4 id="nnrrelu"><code class="language-plaintext highlighter-rouge">nn.RReLU</code></h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">lower</code>ï¼šå‡åŒ€åˆ†å¸ƒä¸‹é™ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">upper</code>ï¼šå‡åŒ€åˆ†å¸ƒä¸Šé™ã€‚</li>
</ul>

<h2 id="4-æ€»ç»“">4. æ€»ç»“</h2>

<p>æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† <code class="language-plaintext highlighter-rouge">nn</code> æ¨¡å—ä¸­æ± åŒ–å±‚ã€çº¿æ€§å±‚å’Œæ¿€æ´»å‡½æ•°å±‚ã€‚åœ¨æ± åŒ–å±‚ä¸­æœ‰æ­£å¸¸çš„æœ€å¤§å€¼æ± åŒ–ã€å‡å€¼æ± åŒ–ï¼Œè¿˜æœ‰å›¾åƒåˆ†å‰²ä»»åŠ¡ä¸­å¸¸ç”¨çš„åæ± åŒ– â€”â€” MaxUnpoolï¼›åœ¨æ¿€æ´»å‡½æ•°ä¸­æˆ‘ä»¬å­¦ä¹ äº† Sigmoidã€Tanh å’Œ Reluï¼Œä»¥åŠ Relu çš„å„ç§å˜ä½“ï¼Œå¦‚ LeakyReLUã€PReLUã€RReLUã€‚ä¸‹èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç½‘ç»œå±‚æƒå€¼çš„åˆå§‹åŒ–ã€‚</p>

<p>ä¸‹èŠ‚å†…å®¹ï¼šæƒå€¼åˆå§‹åŒ–</p>
:ET